<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Route Finder with Multiple Routes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <style type="text/css">
    /* Modern Design System */
    :root {
      /* Typography Scale */
      --font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Inter', system-ui, sans-serif;
      --font-size-xs: 12px;
      --font-size-sm: 14px;
      --font-size-base: 16px;
      --font-size-lg: 20px;
      --font-size-xl: 24px;
      
      /* Font Weights */
      --font-weight-normal: 400;
      --font-weight-medium: 500;
      --font-weight-semibold: 600;
      
      /* Spacing System (4px base) */
      --space-1: 4px;
      --space-2: 8px;
      --space-3: 12px;
      --space-4: 16px;
      --space-5: 20px;
      --space-6: 24px;
      --space-8: 32px;
      --space-10: 40px;
      --space-12: 48px;
      
      /* Color System */
      --color-primary: #007AFF;
      --color-primary-hover: #0056CC;
      --color-secondary: #5856D6;
      --color-success: #34C759;
      --color-warning: #FF9500;
      --color-error: #FF3B30;
      
      --color-bg-primary: #FFFFFF;
      --color-bg-secondary: #F2F2F7;
      --color-bg-tertiary: #FFFFFF;
      
      --color-text-primary: #000000;
      --color-text-secondary: #3C3C43;
      --color-text-tertiary: #8E8E93;
      
      --color-border: #C6C6C8;
      --color-border-light: #E5E5EA;
      
      /* Shadows */
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
      --shadow-md: 0 2px 8px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 4px 16px rgba(0, 0, 0, 0.12);
      
      /* Border Radius */
      --radius-sm: 6px;
      --radius-md: 8px;
      --radius-lg: 12px;
      --radius-xl: 16px;
      
      /* Transitions */
      --transition-fast: 150ms ease-out;
      --transition-base: 300ms ease-out;
      --transition-slow: 500ms ease-out;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: var(--font-family);
      font-size: var(--font-size-base);
      font-weight: var(--font-weight-normal);
      line-height: 1.5;
      color: var(--color-text-primary);
      background-color: var(--color-bg-secondary);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
     
    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
    }
     
    .sidebar {
      position: absolute;
      margin: var(--space-5);
      width: 380px;
      max-height: calc(100vh - var(--space-10));
      top: 0;
      padding: 0;
      background-color: var(--color-bg-primary);
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
      border-radius: var(--radius-xl);
      z-index: 1000;
      transition: transform var(--transition-base);
      border: 1px solid var(--color-border-light);
    }

    .sidebar.hidden {
      transform: translateX(-100%);
    }

    .toggle-btn {
      position: absolute;
      top: var(--space-5);
      left: var(--space-5);
      width: var(--space-10);
      height: var(--space-10);
      background-color: var(--color-bg-primary);
      border: 1px solid var(--color-border-light);
      border-radius: var(--radius-md);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--font-size-lg);
      z-index: 1001;
      box-shadow: var(--shadow-md);
      transition: all var(--transition-fast);
      color: var(--color-text-secondary);
    }

    .toggle-btn:hover {
      background-color: var(--color-bg-secondary);
      box-shadow: var(--shadow-lg);
    }

    .toggle-btn.sidebar-hidden {
      left: var(--space-5);
    }

    .toggle-btn.sidebar-visible {
      left: 420px;
    }

    /* Card System */
    .card {
      background-color: var(--color-bg-primary);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--color-border-light);
      margin-bottom: var(--space-4);
      overflow: hidden;
      transition: box-shadow var(--transition-fast);
    }

    .card:hover {
      box-shadow: var(--shadow-md);
    }

    .card-header {
      padding: var(--space-4) var(--space-5);
      background-color: var(--color-bg-secondary);
      border-bottom: 1px solid var(--color-border-light);
      font-weight: var(--font-weight-semibold);
      font-size: var(--font-size-base);
      color: var(--color-text-primary);
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      user-select: none;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .card-header:hover {
      background-color: #EBEBF0;
    }

    .card-header .icon {
      font-size: var(--font-size-sm);
      color: var(--color-text-tertiary);
      margin-right: var(--space-2);
    }

    .card-header .chevron {
      font-size: var(--font-size-sm);
      color: var(--color-text-tertiary);
      transition: transform var(--transition-fast);
    }

    .card-header.collapsed .chevron {
      transform: rotate(90deg);
    }

    .card-content {
      padding: var(--space-5);
    }

    .card-content.collapsible {
      max-height: 1000px;
      overflow: hidden;
      transition: max-height var(--transition-base), padding var(--transition-base);
    }

    .card-content.collapsed {
      max-height: 0;
      padding-top: 0;
      padding-bottom: 0;
    }

    /* Main Container */
    .sidebar-container {
      padding: var(--space-5);
      display: flex;
      flex-direction: column;
      gap: var(--space-4);
    }

    /* Status Message */
    .status-message {
      padding: var(--space-4);
      border-radius: var(--radius-md);
      margin-bottom: var(--space-4);
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-medium);
      border: 1px solid;
    }

    .status-loading {
      background-color: #FFF4E6;
      border-color: #FFE4B3;
      color: #8B5A00;
    }

    .status-success {
      background-color: #F0FDF4;
      border-color: #BBF7D0;
      color: #166534;
    }

    .status-error {
      background-color: #FEF2F2;
      border-color: #FECACA;
      color: #991B1B;
    }

    /* Form Elements */
    .form-group {
      margin-bottom: var(--space-4);
    }

    .form-group:last-child {
      margin-bottom: 0;
    }

    .form-label {
      display: block;
      font-weight: var(--font-weight-medium);
      font-size: var(--font-size-sm);
      color: var(--color-text-primary);
      margin-bottom: var(--space-2);
    }

    .form-input,
    .form-select {
      width: 100%;
      padding: var(--space-3) var(--space-4);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      font-size: var(--font-size-sm);
      font-family: var(--font-family);
      background-color: var(--color-bg-primary);
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
    }

    .form-input:focus,
    .form-select:focus {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
    }

    /* Button System */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: var(--space-3) var(--space-4);
      border: none;
      border-radius: var(--radius-md);
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-medium);
      font-family: var(--font-family);
      cursor: pointer;
      transition: all var(--transition-fast);
      text-decoration: none;
      gap: var(--space-2);
    }

    .btn-primary {
      background-color: var(--color-primary);
      color: white;
    }

    .btn-primary:hover {
      background-color: var(--color-primary-hover);
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .btn-secondary {
      background-color: var(--color-bg-secondary);
      color: var(--color-text-primary);
      border: 1px solid var(--color-border);
    }

    .btn-secondary:hover {
      background-color: #EBEBF0;
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    .btn-small {
      padding: var(--space-2) var(--space-3);
      font-size: var(--font-size-xs);
    }

    .btn-full {
      width: 100%;
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }

    /* Route Controls */
    .route-controls {
      display: flex;
      gap: var(--space-3);
      align-items: center;
      margin-top: var(--space-4);
    }

    .route-controls input[type="color"] {
      width: var(--space-8);
      height: var(--space-8);
      padding: 0;
      border: 1px solid var(--color-border);
      border-radius: var(--radius-sm);
      cursor: pointer;
    }

    .route-controls input[type="number"] {
      width: 80px;
    }

    /* Route Tabs */
    .route-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-2);
      margin-bottom: var(--space-4);
      padding-bottom: var(--space-4);
      border-bottom: 1px solid var(--color-border-light);
    }

    .route-tab {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-2) var(--space-3);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      background-color: var(--color-bg-secondary);
      cursor: pointer;
      font-size: var(--font-size-xs);
      font-weight: var(--font-weight-medium);
      transition: all var(--transition-fast);
      min-width: 80px;
      justify-content: center;
    }

    .route-tab:hover {
      background-color: #EBEBF0;
      transform: translateY(-1px);
    }

    .route-tab.active {
      background-color: var(--color-primary);
      color: white;
      border-color: var(--color-primary);
    }

    .route-tab .color-indicator {
      width: var(--space-3);
      height: var(--space-3);
      border-radius: 50%;
      border: 1px solid rgba(0,0,0,0.2);
    }

    .route-tab .close-btn {
      background: none;
      border: none;
      color: inherit;
      cursor: pointer;
      padding: 0;
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-semibold);
      width: var(--space-4);
      height: var(--space-4);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color var(--transition-fast);
    }

    .route-tab .close-btn:hover {
      background-color: rgba(255,255,255,0.2);
    }

    /* Waypoint List */
    .waypoint-list {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid var(--color-border-light);
      border-radius: var(--radius-md);
      background-color: var(--color-bg-secondary);
      margin-top: var(--space-3);
    }

    .waypoint-item {
      display: flex;
      align-items: center;
      padding: var(--space-3);
      border-bottom: 1px solid var(--color-border-light);
      background-color: var(--color-bg-primary);
      margin: var(--space-1);
      border-radius: var(--radius-sm);
    }

    .waypoint-item:last-child {
      border-bottom: none;
    }

    .waypoint-number {
      width: var(--space-6);
      height: var(--space-6);
      border-radius: 50%;
      background-color: var(--color-primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--font-size-xs);
      font-weight: var(--font-weight-semibold);
      margin-right: var(--space-3);
      flex-shrink: 0;
    }

    .waypoint-text {
      flex: 1;
      font-size: var(--font-size-xs);
      color: var(--color-text-secondary);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .waypoint-controls {
      display: flex;
      gap: var(--space-2);
      flex-shrink: 0;
    }

    .waypoint-controls button {
      width: var(--space-6);
      height: var(--space-6);
      padding: 0;
      font-size: var(--font-size-xs);
      border-radius: var(--radius-sm);
    }

    /* Route List */
    .route-list {
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid var(--color-border-light);
      border-radius: var(--radius-md);
      background-color: var(--color-bg-secondary);
      margin-top: var(--space-3);
    }

    .route-list-item {
      display: flex;
      align-items: center;
      padding: var(--space-3);
      border-bottom: 1px solid var(--color-border-light);
      background-color: var(--color-bg-primary);
      margin: var(--space-1);
      border-radius: var(--radius-sm);
      transition: background-color var(--transition-fast);
    }

    .route-list-item:hover {
      background-color: var(--color-bg-secondary);
    }

    .route-list-item:last-child {
      border-bottom: none;
    }

    .route-info {
      flex: 1;
      font-size: var(--font-size-xs);
    }

    .route-name {
      font-weight: var(--font-weight-semibold);
      color: var(--color-text-primary);
      margin-bottom: var(--space-1);
    }

    .route-status {
      color: var(--color-text-tertiary);
      font-size: var(--font-size-xs);
    }

    .visibility-btn {
      width: var(--space-8);
      height: var(--space-8);
      padding: 0;
      font-size: var(--font-size-sm);
      margin-right: var(--space-2);
      border-radius: var(--radius-sm);
    }

    .visibility-btn.hidden {
      background-color: var(--color-text-tertiary);
    }

    /* Map Controls */
    .zoom-controls {
      display: flex;
      gap: var(--space-3);
      margin-top: var(--space-4);
    }

    .zoom-controls button {
      height: var(--space-10);
      font-size: var(--font-size-lg);
      font-weight: var(--font-weight-semibold);
    }

    /* Crosshair */
    .map-crosshair {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 30px;
      height: 30px;
      pointer-events: none;
      z-index: 1000;
    }

    .map-crosshair::before,
    .map-crosshair::after {
      content: '';
      position: absolute;
      background-color: #ff0000;
      box-shadow: 0 0 0 1px #ffffff;
    }

    .map-crosshair::before {
      top: 50%;
      left: 2px;
      right: 2px;
      height: 2px;
      transform: translateY(-50%);
    }

    .map-crosshair::after {
      left: 50%;
      top: 2px;
      bottom: 2px;
      width: 2px;
      transform: translateX(-50%);
    }

    .map-crosshair .center-circle {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 8px;
      height: 8px;
      border: 2px solid #ff0000;
      border-radius: 50%;
      background-color: #ffffff;
      box-shadow: 0 0 0 1px #ffffff;
    }

    /* Button Grid */
    .button-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-2);
      margin-top: var(--space-3);
    }

    .button-row {
      display: flex;
      gap: var(--space-2);
      margin-top: var(--space-3);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .sidebar {
        width: calc(100vw - var(--space-10));
        margin: var(--space-3);
      }
      
      .toggle-btn.sidebar-visible {
        left: calc(100vw - var(--space-5) - var(--space-10));
      }
    }

    /* Animation Classes */
    .fade-in {
      animation: fadeIn var(--transition-base) ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .slide-down {
      animation: slideDown var(--transition-base) ease-out;
    }

    @keyframes slideDown {
      from { max-height: 0; opacity: 0; }
      to { max-height: 1000px; opacity: 1; }
    }
  </style>
</head>
 
<body>
  <div id="map"></div>
  
  <!-- Map crosshair indicator -->
  <div id="map-crosshair" class="map-crosshair" style="display: none;">
    <div class="center-circle"></div>
  </div>
  
  <div class="toggle-btn sidebar-visible" id="toggle-btn" onclick="RouteFinderApp.ui.toggleSidebar()">
    ☰
  </div>
  
  <div class="sidebar" id="sidebar">
    <div class="sidebar-container">
      <div id="status-message" class="status-message status-loading">
        <strong>🔄 Initializing...</strong><br>
        Loading mapping application...
      </div>

      <!-- Route Management Section -->
      <div class="card" id="route-management" style="display: none;">
        <div class="card-header" onclick="RouteFinderApp.ui.toggleSection('route-management')">
          <div style="display: flex; align-items: center;">
            <span>Route Management</span>
          </div>
          <span class="chevron">▽</span>
        </div>
        <div class="card-content collapsible" id="route-management-content">
          <div class="route-tabs" id="route-tabs">
            <!-- Route tabs will be dynamically generated -->
          </div>
          
          <button class="btn btn-primary btn-full" onclick="RouteFinderApp.routes.createNewRoute()">
            <span>+</span> New Route
          </button>
          
          <div class="button-grid" style="margin-top: var(--space-4);">
            <button class="btn btn-secondary" onclick="RouteFinderApp.fileManager.exportRoutes()">
              <span>↗</span> Export
            </button>
            <button class="btn btn-secondary" onclick="RouteFinderApp.fileManager.triggerImportRoutes()">
              <span>↙</span> Import
            </button>
          </div>
          
          <!-- Hidden file input for importing -->
          <input type="file" id="import-file-input" accept=".json" style="display: none;" onchange="RouteFinderApp.fileManager.importRoutes(event)">
          
          <div class="route-list" id="route-list" style="display: none;">
            <!-- Route list items will be dynamically generated -->
          </div>
          
          <button class="btn btn-secondary btn-full" onclick="RouteFinderApp.ui.toggleRouteList()" id="route-list-toggle" style="display: none; margin-top: var(--space-3);">
            ⋯ Show All Routes
          </button>
        </div>
      </div>

      <!-- Current Route Controls -->
      <div class="card" id="current-route-panel" style="display: none;">
        <div class="card-header" onclick="RouteFinderApp.ui.toggleSection('current-route')">
          <div style="display: flex; align-items: center;">
            <span id="current-route-header">Current Route</span>
          </div>
          <span class="chevron">▽</span>
        </div>
        <div class="card-content collapsible" id="current-route-content">
          <div class="form-group">
            <label class="form-label">Starting Point</label>
            <input type="text" class="form-input" id="origin-input" placeholder="Enter address or place name">
            <button class="btn btn-secondary btn-full" onclick="RouteFinderApp.geocoding.geocodeOrigin()" style="margin-top: var(--space-2);">
              📍 Find Location
            </button>
          </div>
          
          <div class="form-group">
            <label class="form-label">Destination</label>
            <input type="text" class="form-input" id="destination-input" placeholder="Enter address or place name">
            <button class="btn btn-secondary btn-full" onclick="RouteFinderApp.geocoding.geocodeDestination()" style="margin-top: var(--space-2);">
              📍 Find Location
            </button>
          </div>
          
          <div class="form-group">
            <label class="form-label">Waypoints</label>
            <input type="text" class="form-input" id="waypoint-input" placeholder="Enter intermediate stop">
            <div class="button-grid">
              <button class="btn btn-secondary" onclick="RouteFinderApp.waypoints.addWaypoint()">
                + Add
              </button>
              <button class="btn btn-secondary" onclick="RouteFinderApp.waypoints.toggleWaypointMode()" id="waypoint-mode-btn">
                🗺️ Click Map
              </button>
            </div>
            
            <div id="waypoint-list" class="waypoint-list" style="display: none;">
              <!-- Waypoints will be added here dynamically -->
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Travel Mode</label>
            <select class="form-select" id="profile-select">
              <option value="driving">Car</option>
              <option value="walking">Walk</option>
              <option value="cycling">Bike</option>
            </select>
          </div>
          
          <div class="button-row">
            <button class="btn btn-primary" onclick="RouteFinderApp.routing.findRoute()" style="flex: 2;">
              🔍 Find Route
            </button>
            <button class="btn btn-secondary" onclick="RouteFinderApp.routes.clearCurrentRoute()" style="flex: 1;">
              ✕ Clear
            </button>
          </div>
          
          <div class="route-controls">
            <label style="font-size: var(--font-size-xs); color: var(--color-text-secondary);">Color:</label>
            <input type="color" id="routeColor" value="#ff0000" onchange="RouteFinderApp.routes.updateCurrentRouteStyle()">
            <label style="font-size: var(--font-size-xs); color: var(--color-text-secondary);">Width:</label>
            <input type="number" class="form-input" id="routeWidth" value="8" min="1" max="20" onchange="RouteFinderApp.routes.updateCurrentRouteStyle()">
          </div>
        </div>
      </div>

      <!-- Map Controls -->
      <div class="card" id="map-controls" style="display: none;">
        <div class="card-header" onclick="RouteFinderApp.ui.toggleSection('map-controls')">
          <div style="display: flex; align-items: center;">
            <span>Map Controls</span>
          </div>
          <span class="chevron">▽</span>
        </div>
        <div class="card-content collapsible" id="map-controls-content">
          <div class="form-group">
            <label class="form-label">Map Style</label>
            <select class="form-select" id="map-style-select" onchange="RouteFinderApp.mapControls.changeMapStyle()">
              <option value="mapbox://styles/cb29/ckxnnmex53n1b14m07t6sum48">Classic Standard</option>
              <option value="mapbox://styles/cb29/ckxnmjiti0rvm14pby8w9si99">Classic Vintage</option>
              <option value="mapbox://styles/cb29/ckxov33jj3le314ueu15gl6yh">Dark Digital</option>
              <option value="mapbox://styles/cb29/ckxmhuc4k2gxm14s0eq1htzns">Dark Monochrome</option>
              <option value="mapbox://styles/cb29/ckxs1bfov2cay14mnx6nvrzxt">Dark Night Mode</option>
              <option value="mapbox://styles/cb29/ckwgtu6ly20cr15qiy9i2ftsz">Light Engraved</option>
              <option value="mapbox://styles/cb29/ckxntkwjq4flv14ld7uisp5b1">Light High Contrast</option>
              <option value="mapbox://styles/cb29/ckxouv50s02lw14r2jiyvnvxh">Light Pencil Sketch</option>
              <option value="mapbox://styles/cb29/ckxtl08qj2gb215p8y2blzxur">Pastel Blue</option>
              <option value="mapbox://styles/cb29/ckxtkuk8l10zj14pk8irf7owt">Pastel Cool</option>
              <option value="mapbox://styles/cb29/ckxtl2a2s0yot14nw9pbn2733">Pastel Pink</option>
              <option value="mapbox://styles/cb29/ckxtl35nk4hsb15mry8rwlg4l">Pastel Yellow</option>
              <option value="mapbox://styles/cb29/ckxmjckme2if514s0v3xq4vxy">Satellite Streets</option>
              <option value="mapbox://styles/cb29/ckxrnuq691z6h14mnuy5jpk5c">Topography Colorful</option>
              <option value="mapbox://styles/cb29/ckxnp39kb5eyw14oaan01mkp0">Topography Globe</option>
              
