<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Route Finder with Multiple Routes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <style type="text/css">
    body {
      margin: 0;
      padding: 0;
      font-family: 'Open Sans', sans-serif;
      background-color: #f0f0f0;
    }

    function setupBasicMapFeatures(map) {
      // Add some basic obstacle data for testing
      const clearances = {
        type: 'FeatureCollection',
        features: [
          {
            type: 'Feature',
            geometry: { type: 'Point', coordinates: [-84.47426, 38.06673] },
            properties: { clearance: "13' 2\"" }
          },
          {
            type: 'Feature', 
            geometry: { type: 'Point', coordinates: [-84.47208, 38.06694] },
            properties: { clearance: "13' 7\"" }
          }
        ]
      };

      // Add obstacles as red circles
      map.addSource('obstacles', {
        type: 'geojson',
        data: clearances
      });

      map.addLayer({
        id: 'obstacles',
        type: 'circle',
        source: 'obstacles',
        paint: {
          'circle-radius': 8,
          'circle-color': '#ff0000',
          'circle-opacity': 0.7,
          'circle-stroke-color': '#ffffff',
          'circle-stroke-width': 2
        }
      });

      logStatus('‚úÖ Basic map features added');
      updateStatus('<strong>üó∫Ô∏è Map Fully Ready!</strong><br>Click the map to test interaction', 'success');
    }
     
    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
    }
     
    .sidebar {
      position: absolute;
      margin: 20px 20px 30px 20px;
      width: 15%;
      min-width: 320px;
      max-height: calc(100vh - 100px);
      top: 0;
      padding: 20px;
      background-color: #fff;
      overflow-y: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      border-radius: 5px;
      z-index: 1000;
      transition: transform 0.3s ease;
    }

    .sidebar.hidden {
      transform: translateX(-100%);
    }

    .toggle-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 40px;
      height: 40px;
      background-color: #fff;
      border: 2px solid #007bff;
      border-radius: 5px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      z-index: 1001;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      transition: left 0.3s ease;
    }

    .toggle-btn.sidebar-hidden {
      left: 20px;
    }

    .toggle-btn.sidebar-visible {
      left: 380px;
    }
     
    .card-header {
      font-weight: bold;
      padding: 6px;
      background-color: #f8f9fa;
      border-radius: 3px;
      margin-bottom: 8px;
    }
     
    .control-panel {
      background-color: #ffffff;
      padding: 15px;
      border-radius: 5px;
      box-shadow: 0 0 0 2px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    .input-group {
      margin-bottom: 10px;
    }

    .input-group label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .input-group input, .input-group select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    .status-message {
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
      font-size: 14px;
    }

    .status-loading {
      background-color: #fff3cd;
      border: 1px solid #ffeaa7;
      color: #856404;
    }

    .status-success {
      background-color: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }

    .status-error {
      background-color: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }

    button {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      border: none;
      border-radius: 4px;
      background-color: #007bff;
      color: white;
      cursor: pointer;
      font-size: 14px;
    }

    button:hover {
      background-color: #0056b3;
    }

    button:disabled {
      background-color: #6c757d;
      cursor: not-allowed;
    }

    .diagnostic-info {
      background-color: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 5px;
      padding: 10px;
      margin: 10px 0;
      font-size: 12px;
      font-family: monospace;
      max-height: 200px;
      overflow-y: auto;
    }

    .network-test {
      background-color: #e3f2fd;
      border: 1px solid #90caf9;
      border-radius: 5px;
      padding: 10px;
      margin: 10px 0;
      font-size: 13px;
    }

    .error-display {
      background-color: #ffebee;
      border: 1px solid #f8bbd9;
      border-radius: 5px;
      padding: 15px;
      margin: 15px 0;
      color: #c62828;
    }

    .safari-warning {
      background-color: #fff3e0;
      border: 1px solid #ffcc02;
      border-radius: 5px;
      padding: 15px;
      margin: 15px 0;
      color: #e65100;
    }
  </style>
</head>
 
<body>
  <div id="map"></div>
  
  <div class="toggle-btn sidebar-visible" id="toggle-btn" onclick="toggleSidebar()">
    ‚ò∞
  </div>
  
  <div class="sidebar" id="sidebar">
    <div id="status-message" class="status-message status-loading">
      <strong>üîÑ Initializing...</strong><br>
      Loading mapping libraries...
    </div>

    <div class="safari-warning">
      <strong>ü¶Å Safari Users:</strong><br>
      If the map doesn't load, please try:<br>
      ‚Ä¢ Check Safari's security settings<br>
      ‚Ä¢ Allow loading external content<br>
      ‚Ä¢ Try Chrome or Firefox as alternative
    </div>

    <div class="control-panel">
      <div class="card-header">üìã System Status</div>
      <button onclick="testBasicFunctionality()" id="test-btn">üß™ Test Basic Functions</button>
      <button onclick="loadMapboxLibraries()" id="load-btn">üì• Load Map Libraries</button>
      <button onclick="initializeMap()" id="init-btn" disabled>üó∫Ô∏è Initialize Map</button>
      <button onclick="testNetworkAccess()" id="network-btn">üåê Test Network</button>
    </div>

    <div class="network-test">
      <strong>üîç System Information:</strong>
      <div id="diagnostic-results" class="diagnostic-info">
        Browser: <span id="browser-info">Detecting...</span><br>
        JavaScript: <span id="js-status">Testing...</span><br>
        Network: <span id="network-status">Testing...</span><br>
        Libraries: <span id="library-status">Not loaded</span>
      </div>
    </div>

    <div id="error-display" class="error-display" style="display: none;">
      <strong>‚ùå Error Details:</strong>
      <div id="error-content"></div>
    </div>

    <div class="control-panel">
      <div class="card-header">‚ÑπÔ∏è Instructions</div>
      <p><strong>1. Test Basic Functions</strong> - Verify JavaScript works</p>
      <p><strong>2. Load Map Libraries</strong> - Download required libraries</p>
      <p><strong>3. Initialize Map</strong> - Start the mapping application</p>
      <p><strong>4. Test Network</strong> - Check external connections</p>
    </div>
  </div>

  <script>
    console.log('=== SCRIPT STARTING ===');
    
    // Global variables
    let mapboxLibrariesLoaded = false;
    let mapInitialized = false;
    let networkAccessible = false;

    // Basic logging function
    function logStatus(message) {
      console.log(message);
      const diagnosticEl = document.getElementById('diagnostic-results');
      if (diagnosticEl) {
        diagnosticEl.innerHTML += '<br>' + message;
        diagnosticEl.scrollTop = diagnosticEl.scrollHeight;
      }
    }

    function updateStatus(message, type) {
      const statusEl = document.getElementById('status-message');
      if (statusEl) {
        statusEl.className = 'status-message status-' + type;
        statusEl.innerHTML = message;
      }
      console.log('STATUS: ' + message);
    }

    function showError(error) {
      const errorEl = document.getElementById('error-display');
      const errorContent = document.getElementById('error-content');
      if (errorEl && errorContent) {
        errorContent.innerHTML = error;
        errorEl.style.display = 'block';
      }
      console.error('ERROR: ' + error);
    }

    function testBasicFunctionality() {
      logStatus('=== Testing Basic Functionality ===');
      
      try {
        // Test JavaScript features
        document.getElementById('js-status').textContent = 'Working ‚úÖ';
        
        // Test browser detection
        const browserInfo = navigator.userAgent.includes('Safari') ? 'Safari ü¶Å' : 
                           navigator.userAgent.includes('Chrome') ? 'Chrome üü¢' :
                           navigator.userAgent.includes('Firefox') ? 'Firefox ü¶ä' : 'Unknown';
        document.getElementById('browser-info').textContent = browserInfo;
        
        // Test DOM manipulation
        updateStatus('<strong>‚úÖ Basic Functions Working!</strong><br>JavaScript and DOM access confirmed', 'success');
        
        // Enable next step
        document.getElementById('load-btn').disabled = false;
        
        logStatus('‚úÖ Basic functionality test passed');
        return true;
        
      } catch (error) {
        showError('Basic functionality test failed: ' + error.message);
        return false;
      }
    }

    function loadMapboxLibraries() {
      logStatus('=== Loading Mapbox Libraries ===');
      updateStatus('<strong>üì• Loading Libraries...</strong><br>Downloading Mapbox GL JS...', 'loading');
      
      try {
        // Load Mapbox GL JS
        const script = document.createElement('script');
        script.src = 'https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js';
        script.crossOrigin = 'anonymous';
        
        script.onload = function() {
          logStatus('‚úÖ Mapbox GL JS loaded');
          
          // Load CSS
          const link = document.createElement('link');
          link.rel = 'stylesheet';
          link.href = 'https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css';
          link.crossOrigin = 'anonymous';
          
          link.onload = function() {
            logStatus('‚úÖ Mapbox GL CSS loaded');
            loadTurfLibrary();
          };
          
          link.onerror = function() {
            showError('Failed to load Mapbox GL CSS');
          };
          
          document.head.appendChild(link);
        };
        
        script.onerror = function() {
          showError('Failed to load Mapbox GL JS - check network connection and Safari security settings');
          updateStatus('<strong>‚ùå Library Load Failed</strong><br>Check Safari security settings', 'error');
        };
        
        document.head.appendChild(script);
        
      } catch (error) {
        showError('Library loading error: ' + error.message);
      }
    }

    function loadTurfLibrary() {
      logStatus('Loading Turf.js library...');
      
      const script = document.createElement('script');
      script.src = 'https://unpkg.com/@turf/turf@6/turf.min.js';
      script.crossOrigin = 'anonymous';
      
      script.onload = function() {
        logStatus('‚úÖ Turf.js loaded');
        mapboxLibrariesLoaded = true;
        document.getElementById('library-status').textContent = 'Loaded ‚úÖ';
        document.getElementById('init-btn').disabled = false;
        updateStatus('<strong>‚úÖ Libraries Loaded!</strong><br>Ready to initialize map', 'success');
      };
      
      script.onerror = function() {
        showError('Failed to load Turf.js library');
      };
      
      document.head.appendChild(script);
    }

    function initializeMap() {
      if (!mapboxLibrariesLoaded) {
        showError('Libraries not loaded yet - click "Load Map Libraries" first');
        return;
      }
      
      logStatus('=== Initializing Map ===');
      updateStatus('<strong>üó∫Ô∏è Creating Map...</strong><br>Setting up Mapbox instance...', 'loading');
      
      try {
        if (typeof mapboxgl === 'undefined') {
          throw new Error('Mapbox GL not available');
        }
        
        // Set access token
        mapboxgl.accessToken = 'pk.eyJ1IjoiY2IyOSIsImEiOiJja3E4OHo3anowZGx1Mm9tcXF3ZmhyaWtwIn0.IQ5rY622AU9GOETrqa9NBw';
        
        // Create map
        const map = new mapboxgl.Map({
          container: 'map',
          style: 'mapbox://styles/mapbox/streets-v11',
          center: [-84.5, 38.05],
          zoom: 10
        });
        
        map.on('load', function() {
          logStatus('‚úÖ Map initialized successfully!');
          updateStatus('<strong>üéâ Map Ready!</strong><br>Mapping application is now functional', 'success');
          mapInitialized = true;
          
          // Don't clear the map container - let Mapbox handle it
          // Add basic map features
          setupBasicMapFeatures(map);
        });
        
        map.on('error', function(e) {
          throw new Error('Map error: ' + (e.error ? e.error.message : 'unknown'));
        });
        
      } catch (error) {
        showError('Map initialization failed: ' + error.message);
        updateStatus('<strong>‚ùå Map Failed</strong><br>' + error.message, 'error');
      }
    }

    function testNetworkAccess() {
      logStatus('=== Testing Network Access ===');
      updateStatus('<strong>üåê Testing Network...</strong><br>Checking external connections...', 'loading');
      
      // Test fetch to Mapbox API
      fetch('https://api.mapbox.com/styles/v1/mapbox/streets-v11?access_token=pk.eyJ1IjoiY2IyOSIsImEiOiJja3E4OHo3anowZGx1Mm9tcXF3ZmhyaWtwIn0.IQ5rY622AU9GOETrqa9NBw')
        .then(response => {
          if (response.ok) {
            logStatus('‚úÖ Network access confirmed');
            document.getElementById('network-status').textContent = 'Connected ‚úÖ';
            networkAccessible = true;
            updateStatus('<strong>‚úÖ Network OK!</strong><br>External services accessible', 'success');
          } else {
            throw new Error('HTTP ' + response.status);
          }
        })
        .catch(error => {
          logStatus('‚ùå Network test failed: ' + error.message);
          document.getElementById('network-status').textContent = 'Failed ‚ùå';
          showError('Network access failed: ' + error.message + '<br>Check internet connection and Safari security settings');
          updateStatus('<strong>‚ùå Network Issue</strong><br>Cannot reach external services', 'error');
        });
    }

    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const toggleBtn = document.getElementById('toggle-btn');
      
      if (sidebar.classList.contains('hidden')) {
        sidebar.classList.remove('hidden');
        toggleBtn.classList.remove('sidebar-hidden');
        toggleBtn.classList.add('sidebar-visible');
      } else {
        sidebar.classList.add('hidden');
        toggleBtn.classList.remove('sidebar-visible');
        toggleBtn.classList.add('sidebar-hidden');
      }
    }

    // Auto-start basic functionality test
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM Content Loaded');
      setTimeout(testBasicFunctionality, 500);
    });

    // Also try on window load
    window.addEventListener('load', function() {
      console.log('Window Load Event');
      if (!document.getElementById('js-status').textContent.includes('‚úÖ')) {
        testBasicFunctionality();
      }
    });

    console.log('=== SCRIPT LOADED ===');
  </script>
</body>
</html>
