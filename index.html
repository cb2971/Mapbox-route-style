<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="utf-8" />
Â  <title>Route Finder with Multiple Routes</title>
Â  <meta name="viewport" content="width=device-width, initial-scale=1" />
Â  <style type="text/css">
Â  Â  Â  Â  /* Modern Design System */
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  /* Typography Scale */
Â  Â  Â  Â  Â  Â  --font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Inter', system-ui, sans-serif;
Â  Â  Â  Â  Â  Â  --font-size-xs: 12px;
Â  Â  Â  Â  Â  Â  --font-size-sm: 14px;
Â  Â  Â  Â  Â  Â  --font-size-base: 16px;
Â  Â  Â  Â  Â  Â  --font-size-lg: 20px;
Â  Â  Â  Â  Â  Â  --font-size-xl: 24px;
Â  Â  Â  Â  Â  Â  /* Font Weights */
Â  Â  Â  Â  Â  Â  --font-weight-normal: 400;
Â  Â  Â  Â  Â  Â  --font-weight-medium: 500;
Â  Â  Â  Â  Â  Â  --font-weight-semibold: 600;
Â  Â  Â  Â  Â  Â  /* Spacing System (4px base) */
Â  Â  Â  Â  Â  Â  --space-1: 4px;
Â  Â  Â  Â  Â  Â  --space-2: 8px;
Â  Â  Â  Â  Â  Â  --space-3: 12px;
Â  Â  Â  Â  Â  Â  --space-4: 16px;
Â  Â  Â  Â  Â  Â  --space-5: 20px;
Â  Â  Â  Â  Â  Â  --space-6: 24px;
Â  Â  Â  Â  Â  Â  --space-8: 32px;
Â  Â  Â  Â  Â  Â  --space-10: 40px;
Â  Â  Â  Â  Â  Â  --space-12: 48px;
Â  Â  Â  Â  Â  Â  /* Color System */
Â  Â  Â  Â  Â  Â  --color-primary: #007AFF;
Â  Â  Â  Â  Â  Â  --color-primary-hover: #0056CC;
Â  Â  Â  Â  Â  Â  --color-secondary: #5856D6;
Â  Â  Â  Â  Â  Â  --color-success: #34C759;
Â  Â  Â  Â  Â  Â  --color-warning: #FF9500;
Â  Â  Â  Â  Â  Â  --color-error: #FF3B30;
Â  Â  Â  Â  Â  Â  --color-bg-primary: #FFFFFF;
Â  Â  Â  Â  Â  Â  --color-bg-secondary: #F2F2F7;
Â  Â  Â  Â  Â  Â  --color-bg-tertiary: #FFFFFF;
Â  Â  Â  Â  Â  Â  --color-text-primary: #000000;
Â  Â  Â  Â  Â  Â  --color-text-secondary: #3C3C43;
Â  Â  Â  Â  Â  Â  --color-text-tertiary: #8E8E93;
Â  Â  Â  Â  Â  Â  --color-border: #C6C6C8;
Â  Â  Â  Â  Â  Â  --color-border-light: #E5E5EA;
Â  Â  Â  Â  Â  Â  /* Shadows */
Â  Â  Â  Â  Â  Â  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
Â  Â  Â  Â  Â  Â  --shadow-md: 0 2px 8px rgba(0, 0, 0, 0.1);
Â  Â  Â  Â  Â  Â  --shadow-lg: 0 4px 16px rgba(0, 0, 0, 0.12);
Â  Â  Â  Â  Â  Â  /* Border Radius */
Â  Â  Â  Â  Â  Â  --radius-sm: 6px;
Â  Â  Â  Â  Â  Â  --radius-md: 8px;
Â  Â  Â  Â  Â  Â  --radius-lg: 12px;
Â  Â  Â  Â  Â  Â  --radius-xl: 16px;
Â  Â  Â  Â  Â  Â  /* Transitions */
Â  Â  Â  Â  Â  Â  --transition-fast: 150ms ease-out;
Â  Â  Â  Â  Â  Â  --transition-base: 300ms ease-out;
Â  Â  Â  Â  Â  Â  --transition-slow: 500ms ease-out;
Â  Â  }Â  Â  
Â  Â  Â  Â  * {
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  }Â  Â  
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  font-family: var(--font-family);
Â  Â  Â  Â  Â  Â  font-size: var(--font-size-base);
Â  Â  Â  Â  Â  Â  font-weight: var(--font-weight-normal);
Â  Â  Â  Â  Â  Â  line-height: 1.5;
Â  Â  Â  Â  Â  Â  color: var(--color-text-primary);
Â  Â  Â  Â  Â  Â  background-color: var(--color-bg-secondary);
Â  Â  Â  Â  Â  Â  -webkit-font-smoothing: antialiased;
Â  Â  Â  Â  Â  Â  -moz-osx-font-smoothing: grayscale;
Â  Â  }Â  Â  
Â  Â  Â  Â  #map {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  bottom: 0;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  }Â  Â  
Â  Â  Â  Â  .sidebar {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  margin: var(--space-5);
Â  Â  Â  Â  Â  Â  width: 380px;
Â  Â  Â  Â  Â  Â  max-height: calc(100vh - var(--space-10));
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  background-color: var(--color-bg-primary);
Â  Â  Â  Â  Â  Â  overflow-y: auto;
Â  Â  Â  Â  Â  Â  box-shadow: var(--shadow-lg);
Â  Â  Â  Â  Â  Â  border-radius: var(--radius-xl);
Â  Â  Â  Â  Â  Â  z-index: 1000;
Â  Â  Â  Â  Â  Â  transition: transform var(--transition-base);
Â  Â  Â  Â  Â  Â  border: 1px solid var(--color-border-light);
Â  Â  }Â  Â  
Â  Â  Â  Â  .sidebar.hidden {
Â  Â  Â  Â  Â  Â  transform: translateX(-100%);
Â  Â  }Â  Â  
Â  Â  Â  Â  .toggle-btn {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: var(--space-5);
Â  Â  Â  Â  Â  Â  left: var(--space-5);
Â  Â  Â  Â  Â  Â  width: var(--space-10);
Â  Â  Â  Â  Â  Â  height: var(--space-10);
Â  Â  Â  Â  Â  Â  background-color: var(--color-bg-primary);
Â  Â  Â  Â  Â  Â  border: 1px solid var(--color-border-light);
Â  Â  Â  Â  Â  Â  border-radius: var(--radius-md);
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  font-size: var(--font-size-lg);
Â  Â  Â  Â  Â  Â  z-index: 1001;
Â  Â  Â  Â  Â  Â  box-shadow: var(--shadow-md);
Â  Â  Â  Â  Â  Â  transition: all var(--transition-fast);
Â  Â  Â  Â  Â  Â  color: var(--color-text-secondary);
Â  Â  }Â  Â  
Â  Â  Â  Â  .toggle-btn:hover {
Â  Â  Â  Â  Â  Â  background-color: var(--color-bg-secondary);
Â  Â  Â  Â  Â  Â  box-shadow: var(--shadow-lg);
Â  Â  }Â  Â  
Â  Â  Â  Â  .toggle-btn.sidebar-hidden {
Â  Â  Â  Â  Â  Â  left: var(--space-5);
Â  Â  }Â  Â  
Â  Â  Â  Â  .toggle-btn.sidebar-visible {
Â  Â  Â  Â  Â  Â  left: 420px;
Â  Â  }Â  Â  
Â  Â  Â  Â  /* Card System */
Â  Â  Â  Â  .card {
Â  Â  Â  Â  Â  Â  background-color: var(--color-bg-primary);
Â  Â  Â  Â  Â  Â  border-radius: var(--radius-lg);
Â  Â  Â  Â  Â  Â  box-shadow: var(--shadow-sm);
Â  Â  Â  Â  Â  Â  border: 1px solid var(--color-border-light);
Â  Â  Â  Â  Â  Â  margin-bottom: var(--space-4);
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  transition: box-shadow var(--transition-fast);
Â  Â  }Â  Â  
Â  Â  Â  Â  .card:hover {
Â  Â  Â  Â  Â  Â  box-shadow: var(--shadow-md);
Â  Â  }Â  Â  
Â  Â  Â  Â  .card-header {
Â  Â  Â  Â  Â  Â  padding: var(--space-4) var(--space-5);
Â  Â  Â  Â  Â  Â  background-color: var(--color-bg-secondary);
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid var(--color-border-light);
Â  Â  Â  Â  Â  Â  font-weight: var(--font-weight-semibold);
Â  Â  Â  Â  Â  Â  font-size: var(--font-size-base);
Â  Â  Â  Â  Â  Â  color: var(--color-text-primary);
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  user-select: none;
Â  Â  Â  Â  Â  Â  position: sticky;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  z-index: 10;
Â  Â  }Â  Â  
Â  Â  Â  Â  .card-header:hover {
Â  Â  Â  Â  Â  Â  background-color: #EBEBF0;
Â  Â  }Â  Â  
Â  Â  Â  Â  .card-header .icon {
Â  Â  Â  Â  Â  Â  font-size: var(--font-size-sm);
Â  Â  Â  Â  Â  Â  color: var(--color-text-tertiary);
Â  Â  Â  Â  Â  Â  margin-right: var(--space-2);
Â  Â  }Â  Â  
Â  Â  Â  Â  .card-header .chevron {
Â  Â  Â  Â  Â  Â  font-size: var(--font-size-sm);
Â  Â  Â  Â  Â  Â  color: var(--color-text-tertiary);
Â  Â  Â  Â  Â  Â  transition: transform var(--transition-fast);
Â  Â  }Â  Â  
Â  Â  Â  Â  .card-header.collapsed .chevron {
Â  Â  Â  Â  Â  Â  transform: rotate(90deg);
Â  Â  }Â  Â  
Â  Â  Â  Â  .card-content {
Â  Â  Â  Â  Â  Â  padding: var(--space-5);
Â  Â  }Â  Â  
Â  Â  Â  Â  .card-content.collapsible {
Â  Â  Â  Â  Â  Â  max-height: 1000px;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  transition: max-height var(--transition-base), padding var(--transition-base);
Â  Â  }Â  Â  
Â  Â  Â  Â  .card-content.collapsed {
Â  Â  Â  Â  Â  Â  max-height: 0;
Â  Â  Â  Â  Â  Â  padding-top: 0;
Â  Â  Â  Â  Â  Â  padding-bottom: 0;
Â  Â  }Â  Â  
Â  Â  Â  Â  /* Main Container */
Â  Â  Â  Â  .sidebar-container {
Â  Â  Â  Â  Â  Â  padding: var(--space-5);
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  gap: var(--space-4);
Â  Â  }Â  Â  
Â  Â  Â  Â  /* Status Message */
Â  Â  Â  Â  .status-message {
Â  Â  Â  Â  Â  Â  padding: var(--space-4);
Â  Â  Â  Â  Â  Â  border-radius: var(--radius-md);
Â  Â  Â  Â  Â  Â  margin-bottom: var(--space-4);
Â  Â  Â  Â  Â  Â  font-size: var(--font-size-sm);
Â  Â  Â  Â  Â  Â  font-weight: var(--font-weight-medium);
Â  Â  Â  Â  Â  Â  border: 1px solid;
Â  Â  }Â  Â  
Â  Â  Â  Â  .status-loading {
Â  Â  Â  Â  Â  Â  background-color: #FFF4E6;
Â  Â  Â  Â  Â  Â  border-color: #FFE4B3;
Â  Â  Â  Â  Â  Â  color: #8B5A00;
Â  Â  }Â  Â  
Â  Â  Â  Â  .status-success {
Â  Â  Â  Â  Â  Â  background-color: #F0FDF4;
Â  Â  Â  Â  Â  Â  border-color: #BBF7D0;
Â  Â  Â  Â  Â  Â  color: #166534;
Â  Â  }Â  Â  
Â  Â  Â  Â  .status-error {
Â  Â  Â  Â  Â  Â  background-color: #FEF2F2;
Â  Â  Â  Â  Â  Â  border-color: #FECACA;
Â  Â  Â  Â  Â  Â  color: #991B1B;
Â  Â  }Â  Â  
Â  Â  Â  Â  /* Form Elements */
Â  Â  Â  Â  .form-group {
Â  Â  Â  Â  Â  Â  margin-bottom: var(--space-4);
Â  Â  }Â  Â  
Â  Â  Â  Â  .form-group:last-child {
Â  Â  Â  Â  Â  Â  margin-bottom: 0;
Â  Â  }Â  Â  
Â  Â  Â  Â  .form-label {
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  Â  Â  font-weight: var(--font-weight-medium);
Â  Â  Â  Â  Â  Â  font-size: var(--font-size-sm);
Â  Â  Â  Â  Â  Â  color: var(--color-text-primary);
Â  Â  Â  Â  Â  Â  margin-bottom: var(--space-2);
Â  Â  }Â  Â  
Â  Â  Â  Â  .form-input,
Â  Â  .form-selectÂ  Â   {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  padding: var(--space-3) var(--space-4);
Â  Â  Â  Â  Â  Â  border: 1px solid var(--color-border);
Â  Â  Â  Â  Â  Â  border-radius: var(--radius-md);
Â  Â  Â  Â  Â  Â  font-size: var(--font-size-sm);
Â  Â  Â  Â  Â  Â  font-family: var(--font-family);
Â  Â  Â  Â  Â  Â  background-color: var(--color-bg-primary);
Â  Â  Â  Â  Â  Â  transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
Â  Â  }Â  Â  
Â  Â  Â  Â  .form-input:focus,
Â  Â  .form-select:focusÂ  Â   {
Â  Â  Â  Â  Â  Â  outline: none;
Â  Â  Â  Â  Â  Â  border-color: var(--color-primary);
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
Â  Â  }Â  Â  
Â  Â  Â  Â  /* Button System */
Â  Â  Â  Â  .btn {
Â  Â  Â  Â  Â  Â  display: inline-flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  padding: var(--space-3) var(--space-4);
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: var(--radius-md);
Â  Â  Â  Â  Â  Â  font-size: var(--font-size-sm);
Â  Â  Â  Â  Â  Â  font-weight: var(--font-weight-medium);
Â  Â  Â  Â  Â  Â  font-family: var(--font-family);
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: all var(--transition-fast);
Â  Â  Â  Â  Â  Â  text-decoration: none;
Â  Â  Â  Â  Â  Â  gap: var(--space-2);
Â  Â  }Â  Â  
Â  Â  Â  Â  .btn-primary {
Â  Â  Â  Â  Â  Â  background-color: var(--color-primary);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  }Â  Â  
Â  Â  Â  Â  .btn-primary:hover {
Â  Â  Â  Â  Â  Â  background-color: var(--color-primary-hover);
Â  Â  Â  Â  Â  Â  transform: translateY(-1px);
Â  Â  Â  Â  Â  Â  box-shadow: var(--shadow-md);
Â  Â  }Â  Â  
Â  Â  Â  Â  .btn-secondary {
Â  Â  Â  Â  Â  Â  background-color: var(--color-bg-secondary);
Â  Â  Â  Â  Â  Â  color: var(--color-text-primary);
Â  Â  Â  Â  Â  Â  border: 1px solid var(--color-border);
Â  Â  }Â  Â  
Â  Â  Â  Â  .btn-secondary:hover {
Â  Â  Â  Â  Â  Â  background-color: #EBEBF0;
Â  Â  Â  Â  Â  Â  transform: translateY(-1px);
Â  Â  Â  Â  Â  Â  box-shadow: var(--shadow-sm);
Â  Â  }Â  Â  
Â  Â  Â  Â  .btn-small {
Â  Â  Â  Â  Â  Â  padding: var(--space-2) var(--space-3);
Â  Â  Â  Â  Â  Â  font-size: var(--font-size-xs);
Â  Â  }Â  Â  
Â  Â  Â  Â  .btn-full {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  }Â  Â  
Â  Â  Â  Â  .btn:disabled {
Â  Â  Â  Â  Â  Â  opacity: 0.6;
Â  Â  Â  Â  Â  Â  cursor: not-allowed;
Â  Â  Â  Â  Â  Â  transform: none !important;
Â  Â  }Â  Â  
Â  Â  Â  Â  /* Route Controls */
Â  Â  Â  Â  .route-controls {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  gap: var(--space-3);
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  margin-top: var(--space-4);
Â  Â  }Â  Â  
Â  Â  Â  Â  .route-controls input[type="color"] {
Â  Â  Â  Â  Â  Â  width: var(--space-8);
Â  Â  Â  Â  Â  Â  height: var(--space-8);
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  border: 1px solid var(--color-border);
Â  Â  Â  Â  Â  Â  border-radius: var(--radius-sm);
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  }Â  Â  
Â  Â  Â  Â  .route-controls input[type="number"] {
Â  Â  Â  Â  Â  Â  width: 80px;
Â  Â  }Â  Â  
Â  Â  Â  Â  /* Route Tabs */
Â  Â  Â  Â  .route-tabs {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  Â  Â  Â  gap: var(--space-2);
Â  Â  Â  Â  Â  Â  margin-bottom: var(--space-4);
Â  Â  Â  Â  Â  Â  padding-bottom: var(--space-4);
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid var(--color-border-light);
Â  Â  }Â  Â  
Â  Â  Â  Â  .route-tab {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: var(--space-2);
Â  Â  Â  Â  Â  Â  padding: var(--space-2) var(--space-3);
Â  Â  Â  Â  Â  Â  border: 1px solid var(--color-border);
Â  Â  Â  Â  Â  Â  border-radius: var(--radius-md);
Â  Â  Â  Â  Â  Â  background-color: var(--color-bg-secondary);
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-size: var(--font-size-xs);
Â  Â  Â  Â  Â  Â  font-weight: var(--font-weight-medium);
Â  Â  Â  Â  Â  Â  transition: all var(--transition-fast);
Â  Â  Â  Â  Â  Â  min-width: 80px;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  }Â  Â  
Â  Â  Â  Â  .route-tab:hover {
Â  Â  Â  Â  Â  Â  background-color: #EBEBF0;
Â  Â  Â  Â  Â  Â  transform: translateY(-1px);
Â  Â  }Â  Â  
Â  Â  Â  Â  .route-tab.active {
Â  Â  Â  Â  Â  Â  background-color: var(--color-primary);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border-color: var(--color-primary);
Â  Â  }Â  Â  
Â  Â  Â  Â  .route-tab .color-indicator {
Â  Â  Â  Â  Â  Â  width: var(--space-3);
Â  Â  Â  Â  Â  Â  height: var(--space-3);
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  border: 1px solid rgba(0,0,0,0.2);
Â  Â  }Â  Â  
Â  Â  Â  Â  .route-tab .close-btn {
Â  Â  Â  Â  Â  Â  background: none;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  color: inherit;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  font-size: var(--font-size-sm);
Â  Â  Â  Â  Â  Â  font-weight: var(--font-weight-semibold);
Â  Â  Â  Â  Â  Â  width: var(--space-4);
Â  Â  Â  Â  Â  Â  height: var(--space-4);
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  transition: background-color var(--transition-fast);
Â  Â  }Â  Â  
Â  Â  Â  Â  .route-tab .close-btn:hover {
Â  Â  Â  Â  Â  Â  background-color: rgba(255,255,255,0.2);
Â  Â  }Â  Â  
Â  Â  Â  Â  /* Waypoint List */
Â  Â  Â  Â  .waypoint-list {
Â  Â  Â  Â  Â  Â  max-height: 200px;
Â  Â  Â  Â  Â  Â  overflow-y: auto;
Â  Â  Â  Â  Â  Â  border: 1px solid var(--color-border-light);
Â  Â  Â  Â  Â  Â  border-radius: var(--radius-md);
Â  Â  Â  Â  Â  Â  background-color: var(--color-bg-secondary);
Â  Â  Â  Â  Â  Â  margin-top: var(--space-3);
Â  Â  }Â  Â  
Â  Â  Â  Â  .waypoint-item {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  padding: var(--space-3);
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid var(--color-border-light);
Â  Â  Â  Â  Â  Â  background-color: var(--color-bg-primary);
Â  Â  Â  Â  Â  Â  margin: var(--space-1);
Â  Â  Â  Â  Â  Â  border-radius: var(--radius-sm);
Â  Â  }Â  Â  
Â  Â  Â  Â  .waypoint-item:last-child {
Â  Â  Â  Â  Â  Â  border-bottom: none;
Â  Â  }Â  Â  
Â  Â  Â  Â  .waypoint-number {
Â  Â  Â  Â  Â  Â  width: var(--space-6);
Â  Â  Â  Â  Â  Â  height: var(--space-6);
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  background-color: var(--color-primary);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  font-size: var(--font-size-xs);
Â  Â  Â  Â  Â  Â  font-weight: var(--font-weight-semibold);
Â  Â  Â  Â  Â  Â  margin-right: var(--space-3);
Â  Â  Â  Â  Â  Â  flex-shrink: 0;
Â  Â  }Â  Â  
Â  Â  Â  Â  .waypoint-text {
Â  Â  Â  Â  Â  Â  flex: 1;
Â  Â  Â  Â  Â  Â  font-size: var(--font-size-xs);
Â  Â  Â  Â  Â  Â  color: var(--color-text-secondary);
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  text-overflow: ellipsis;
Â  Â  Â  Â  Â  Â  white-space: nowrap;
Â  Â  }Â  Â  
Â  Â  Â  Â  .waypoint-controls {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  gap: var(--space-2);
Â  Â  Â  Â  Â  Â  flex-shrink: 0;
Â  Â  }Â  Â  
Â  Â  Â  Â  .waypoint-controls button {
Â  Â  Â  Â  Â  Â  width: var(--space-6);
Â  Â  Â  Â  Â  Â  height: var(--space-6);
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  font-size: var(--font-size-xs);
Â  Â  Â  Â  Â  Â  border-radius: var(--radius-sm);
Â  Â  }Â  Â  
Â  Â  Â  Â  /* Route List */
Â  Â  Â  Â  .route-list {
Â  Â  Â  Â  Â  Â  max-height: 300px;
Â  Â  Â  Â  Â  Â  overflow-y: auto;
Â  Â  Â  Â  Â  Â  border: 1px solid var(--color-border-light);
Â  Â  Â  Â  Â  Â  border-radius: var(--radius-md);
Â  Â  Â  Â  Â  Â  background-color: var(--color-bg-secondary);
Â  Â  Â  Â  Â  Â  margin-top: var(--space-3);
Â  Â  }Â  Â  
Â  Â  Â  Â  .route-list-item {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  padding: var(--space-3);
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid var(--color-border-light);
Â  Â  Â  Â  Â  Â  background-color: var(--color-bg-primary);
Â  Â  Â  Â  Â  Â  margin: var(--space-1);
Â  Â  Â  Â  Â  Â  border-radius: var(--radius-sm);
Â  Â  Â  Â  Â  Â  transition: background-color var(--transition-fast);
Â  Â  }Â  Â  
Â  Â  Â  Â  .route-list-item:hover {
Â  Â  Â  Â  Â  Â  background-color: var(--color-bg-secondary);
Â  Â  }Â  Â  
Â  Â  Â  Â  .route-list-item:last-child {
Â  Â  Â  Â  Â  Â  border-bottom: none;
Â  Â  }Â  Â  
Â  Â  Â  Â  .route-info {
Â  Â  Â  Â  Â  Â  flex: 1;
Â  Â  Â  Â  Â  Â  font-size: var(--font-size-xs);
Â  Â  }Â  Â  
Â  Â  Â  Â  .route-name {
Â  Â  Â  Â  Â  Â  font-weight: var(--font-weight-semibold);
Â  Â  Â  Â  Â  Â  color: var(--color-text-primary);
Â  Â  Â  Â  Â  Â  margin-bottom: var(--space-1);
Â  Â  }Â  Â  
Â  Â  Â  Â  .route-status {
Â  Â  Â  Â  Â  Â  color: var(--color-text-tertiary);
Â  Â  Â  Â  Â  Â  font-size: var(--font-size-xs);
Â  Â  }Â  Â  
Â  Â  Â  Â  .visibility-btn {
Â  Â  Â  Â  Â  Â  width: var(--space-8);
Â  Â  Â  Â  Â  Â  height: var(--space-8);
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  font-size: var(--font-size-sm);
Â  Â  Â  Â  Â  Â  margin-right: var(--space-2);
Â  Â  Â  Â  Â  Â  border-radius: var(--radius-sm);
Â  Â  }Â  Â  
Â  Â  Â  Â  .visibility-btn.hidden {
Â  Â  Â  Â  Â  Â  background-color: var(--color-text-tertiary);
Â  Â  }Â  Â  
Â  Â  Â  Â  /* Map Controls */
Â  Â  Â  Â  .zoom-controls {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  gap: var(--space-3);
Â  Â  Â  Â  Â  Â  margin-top: var(--space-4);
Â  Â  }Â  Â  
Â  Â  Â  Â  .zoom-controls button {
Â  Â  Â  Â  Â  Â  height: var(--space-10);
Â  Â  Â  Â  Â  Â  font-size: var(--font-size-lg);
Â  Â  Â  Â  Â  Â  font-weight: var(--font-weight-semibold);
Â  Â  }Â  Â  
Â  Â  Â  Â  /* Crosshair */
Â  Â  Â  Â  .map-crosshair {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 50%;
Â  Â  Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  Â  Â  transform: translate(-50%, -50%);
Â  Â  Â  Â  Â  Â  width: 30px;
Â  Â  Â  Â  Â  Â  height: 30px;
Â  Â  Â  Â  Â  Â  pointer-events: none;
Â  Â  Â  Â  Â  Â  z-index: 1000;
Â  Â  }Â  Â  
Â  Â  Â  Â  .map-crosshair::before,
Â  Â  .map-crosshair::afterÂ  Â   {
Â  Â  Â  Â  Â  Â  content: '';
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  background-color: #ff0000;
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 0 1px #ffffff;
Â  Â  }Â  Â  
Â  Â  Â  Â  .map-crosshair::before {
Â  Â  Â  Â  Â  Â  top: 50%;
Â  Â  Â  Â  Â  Â  left: 2px;
Â  Â  Â  Â  Â  Â  right: 2px;
Â  Â  Â  Â  Â  Â  height: 2px;
Â  Â  Â  Â  Â  Â  transform: translateY(-50%);
Â  Â  }Â  Â  
Â  Â  Â  Â  .map-crosshair::after {
Â  Â  Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  Â  Â  top: 2px;
Â  Â  Â  Â  Â  Â  bottom: 2px;
Â  Â  Â  Â  Â  Â  width: 2px;
Â  Â  Â  Â  Â  Â  transform: translateX(-50%);
Â  Â  }Â  Â  
Â  Â  Â  Â  .map-crosshair .center-circle {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 50%;
Â  Â  Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  Â  Â  transform: translate(-50%, -50%);
Â  Â  Â  Â  Â  Â  width: 8px;
Â  Â  Â  Â  Â  Â  height: 8px;
Â  Â  Â  Â  Â  Â  border: 2px solid #ff0000;
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  background-color: #ffffff;
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 0 1px #ffffff;
Â  Â  }Â  Â  
Â  Â  Â  Â  /* Button Grid */
Â  Â  Â  Â  .button-grid {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: 1fr 1fr;
Â  Â  Â  Â  Â  Â  gap: var(--space-2);
Â  Â  Â  Â  Â  Â  margin-top: var(--space-3);
Â  Â  }Â  Â  
Â  Â  Â  Â  .button-row {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  gap: var(--space-2);
Â  Â  Â  Â  Â  Â  margin-top: var(--space-3);
Â  Â  }Â  Â  
Â  Â  Â  Â  /* Responsive Design */
Â  Â  Â  Â  @media (max-width: 768px) {
Â  Â  Â  Â  Â  Â  .sidebar {
Â  Â  Â  Â  Â  Â  Â  Â  width: calc(100vw - var(--space-10));
Â  Â  Â  Â  Â  Â  Â  Â  margin: var(--space-3);
Â  Â  Â  }Â  Â  Â  
Â  Â  Â  Â  Â  Â  .toggle-btn.sidebar-visible {
Â  Â  Â  Â  Â  Â  Â  Â  left: calc(100vw - var(--space-5) - var(--space-10));
Â  Â  Â  }Â  Â  Â  
Â  Â  }Â  Â  
Â  Â  Â  Â  /* Animation Classes */
Â  Â  Â  Â  .fade-in {
Â  Â  Â  Â  Â  Â  animation: fadeIn var(--transition-base) ease-out;
Â  Â  }Â  Â  
Â  Â  Â  Â  @keyframes fadeIn {
Â  Â  Â  Â  Â  Â  from { opacity: 0; transform: translateY(10px); }
Â  Â  Â  Â  Â  Â  to { opacity: 1; transform: translateY(0); }
Â  Â  }Â  Â  
Â  Â  Â  Â  .slide-down {
            animation: slideDown var(--transition-base) ease-out;
    }    
        @keyframes slideDown {
            from { max-height: 0; opacity: 0; }
            to { max-height: 1000px; opacity: 1; }
    }    

        /* Monoline Icon Styles - Style Option 2: Medium Weight Rounded */
        .monoline-icon {
          display: inline-block;
          width: 16px;
          height: 16px;
          stroke: #333;
          stroke-width: 2.5px;
          stroke-linecap: round;
          stroke-linejoin: round;
          fill: none;
          vertical-align: middle;
        }

        .monoline-icon-sm {
          width: 14px;
          height: 14px;
        }

        .monoline-icon-lg {
          width: 20px;
          height: 20px;
        }
  </lt;/style>
</head>
<body>
Â  <div id="map"></div>
Â  Â  <!-- Map crosshair indicator -->
Â  <div id="map-crosshair" class="map-crosshair" style="display: none;">
Â  Â  <div class="center-circle"></div>
Â  </div>
Â  <div class="toggle-btn sidebar-visible" id="toggle-btn" onclick="RouteFinderApp.ui.toggleSidebar()">
Â  Â  â˜°Â  Â  
Â  </div>
Â  <div class="sidebar" id="sidebar">
Â  Â  <div class="sidebar-container">
Â  Â  Â  <div id="status-message" class="status-message status-loading">
Â  Â  Â  Â  <strong>ğŸ”„ Initializing...</strong><br>
Â  Â  Â  Â  Loading mapping application...Â  Â  Â  Â  
Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <!-- Route Management Section -->
Â  Â  Â  <div class="card" id="route-management" style="display: none;">
Â  Â  Â  Â  <div class="card-header" onclick="RouteFinderApp.ui.toggleSection('route-management')">
Â  Â  Â  Â  Â  <div style="display: flex; align-items: center;">
Â  Â  Â  Â  Â  Â  <span class="icon">âš¬</span>
Â  Â  Â  Â  Â  Â  <span>Route Management</span>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <span class="chevron">â–·</span>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="card-content collapsible" id="route-management-content">
Â  Â  Â  Â  Â  <div class="route-tabs" id="route-tabs">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- Route tabs will be dynamically generated -->
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <button class="btn btn-primary btn-full" onclick="RouteFinderApp.routes.createNewRoute()">
Â  Â  Â  Â  Â  Â  <span>+</span> New Route
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  <div class="button-grid" style="margin-top: var(--space-4);">
Â  Â  Â  Â  Â  Â  <button class="btn btn-secondary" onclick="RouteFinderApp.fileManager.exportRoutes()">
Â  Â  Â  Â  Â  Â  Â  <span>â†‘</span> Export
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <button class="btn btn-secondary" onclick="RouteFinderApp.fileManager.triggerImportRoutes()">
Â  Â  Â  Â  Â  Â  Â  <span>â†“</span> Import
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- Hidden file input for importing -->
Â  Â  Â  Â  Â  <input type="file" id="import-file-input" accept=".json" style="display: none;" onchange="RouteFinderApp.fileManager.importRoutes(event)">
Â  Â  Â  Â  Â  <div class="route-list" id="route-list" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- Route list items will be dynamically generated -->
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <button class="btn btn-secondary btn-full" onclick="RouteFinderApp.ui.toggleRouteList()" id="route-list-toggle" style="display: none; margin-top: var(--space-3);">
Â  Â  Â  Â  Â  Â  â‹¯ Show All RoutesÂ  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <!-- Current Route Controls -->
Â  Â  Â  <div class="card" id="current-route-panel" style="display: none;">
Â  Â  Â  Â  <div class="card-header" onclick="RouteFinderApp.ui.toggleSection('current-route')">
Â  Â  Â  Â  Â  <div style="display: flex; align-items: center;">
Â  Â  Â  Â  Â  Â  <span class="icon">â—‹</span>
Â  Â  Â  Â  Â  Â  <span id="current-route-header">Current Route</span>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <span class="chevron">â–·</span>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="card-content collapsible" id="current-route-content">
Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label class="form-label">Starting Point</label>
Â  Â  Â  Â  Â  Â  <input type="text" class="form-input" id="origin-input" placeholder="Enter address or place name">
Â  Â  Â  Â  Â  Â  <button class="btn btn-secondary btn-full" onclick="RouteFinderApp.geocoding.geocodeOrigin()" style="margin-top: var(--space-2);">
Â  Â  Â  Â  Â  Â  Â  â— Find LocationÂ  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label class="form-label">Destination</label>
Â  Â  Â  Â  Â  Â  <input type="text" class="form-input" id="destination-input" placeholder="Enter address or place name">
Â  Â  Â  Â  Â  Â  <button class="btn btn-secondary btn-full" onclick="RouteFinderApp.geocoding.geocodeDestination()" style="margin-top: var(--space-2);">
Â  Â  Â  Â  Â  Â  Â  â— Find LocationÂ  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label class="form-label">Waypoints</label>
Â  Â  Â  Â  Â  Â  <input type="text" class="form-input" id="waypoint-input" placeholder="Enter intermediate stop">
Â  Â  Â  Â  Â  Â  <div class="button-grid">
Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-secondary" onclick="RouteFinderApp.waypoints.addWaypoint()">
Â  Â  Â  Â  Â  Â  Â  Â  + AddÂ  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-secondary" onclick="RouteFinderApp.waypoints.toggleWaypointMode()" id="waypoint-mode-btn">
Â  Â  Â  Â  Â  Â  Â  Â  â—‰ Click MapÂ  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="waypoint-list" class="waypoint-list" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- Waypoints will be added here dynamically -->
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label class="form-label">Travel Mode</label>
Â  Â  Â  Â  Â  Â  <select class="form-select" id="profile-select">
Â  Â  Â  Â  Â  Â  Â  <option value="driving">Car</option>
Â  Â  Â  Â  Â  Â  Â  <option value="walking">Walk</option>
Â  Â  Â  Â  Â  Â  Â  <option value="cycling">Bike</option>
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="button-row">
Â  Â  Â  Â  Â  Â  <button class="btn btn-primary" onclick="RouteFinderApp.routing.findRoute()" style="flex: 2;">
Â  Â  Â  Â  Â  Â  Â  â†’ Find RouteÂ  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <button class="btn btn-secondary" onclick="RouteFinderApp.routes.clearCurrentRoute()" style="flex: 1;">
Â  Â  Â  Â  Â  Â  Â  âœ• ClearÂ  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="route-controls">
Â  Â  Â  Â  Â  Â  <label style="font-size: var(--font-size-xs); color: var(--color-text-secondary);">Color:</label>
Â  Â  Â  Â  Â  Â  <input type="color" id="routeColor" value="#ff0000" onchange="RouteFinderApp.routes.updateCurrentRouteStyle()">
Â  Â  Â  Â  Â  Â  <label style="font-size: var(--font-size-xs); color: var(--color-text-secondary);">Width:</label>
Â  Â  Â  Â  Â  Â  <input type="number" class="form-input" id="routeWidth" value="8" min="1" max="20" onchange="RouteFinderApp.routes.updateCurrentRouteStyle()">
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <!-- Map Controls -->
Â  Â  Â  <div class="card" id="map-controls" style="display: none;">
Â  Â  Â  Â  <div class="card-header" onclick="RouteFinderApp.ui.toggleSection('map-controls')">
Â  Â  Â  Â  Â  <div style="display: flex; align-items: center;">
Â  Â  Â  Â  Â  Â  <span class="icon">â—ˆ</span>
Â  Â  Â  Â  Â  Â  <span>Map Controls</span>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <span class="chevron">â–·</span>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="card-content collapsible" id="map-controls-content">
Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label class="form-label">Map Style</label>
Â  Â  Â  Â  Â  Â  <select class="form-select" id="map-style-select" onchange="RouteFinderApp.mapControls.changeMapStyle()">
Â  Â  Â  Â  Â  Â  Â  <option value="mapbox://styles/cb29/ckxnnmex53n1b14m07t6sum48">Classic Standard</option>
Â  Â  Â  Â  Â  Â  Â  <option value="mapbox://styles/cb29/ckxnmjiti0rvm14pby8w9si99">Classic Vintage</option>
Â  Â  Â  Â  Â  Â  Â  <option value="mapbox://styles/cb29/ckxov33jj3le314ueu15gl6yh">Dark Digital</option>
Â  Â  Â  Â  Â  Â  Â  <option value="mapbox://styles/cb29/ckxmhuc4k2gxm14s0eq1htzns">Dark Monochrome</option>
Â  Â  Â  Â  Â  Â  Â  <option value="mapbox://styles/cb29/ckxs1bfov2cay14mnx6nvrzxt">Dark Night Mode</option>
Â  Â  Â  Â  Â  Â  Â  <option value="mapbox://styles/cb29/ckwgtu6ly20cr15qiy9i2ftsz">Light Engraved</option>
Â  Â  Â  Â  Â  Â  Â  <option value="mapbox://styles/cb29/ckxntkwjq4flv14ld7uisp5b1">Light High Contrast</option>
Â  Â  Â  Â  Â  Â  Â  <option value="mapbox://styles/cb29/ckxouv50s02lw14r2jiyvnvxh">Light Pencil Sketch</option>
Â  Â  Â  Â  Â  Â  Â  <option value="mapbox://styles/cb29/ckxtl08qj2gb215p8y2blzxur">Pastel Blue</option>
Â  Â  Â  Â  Â  Â  Â  <option value="mapbox://styles/cb29/ckxtkuk8l10zj14pk8irf7owt">Pastel Cool</option>
Â  Â  Â  Â  Â  Â  Â  <option value="mapbox://styles/cb29/ckxtl2a2s0yot14nw9pbn2733">Pastel Pink</option>
Â  Â  Â  Â  Â  Â  Â  <option value="mapbox://styles/cb29/ckxtl35nk4hsb15mry8rwlg4l">Pastel Yellow</option>
Â  Â  Â  Â  Â  Â  Â  <option value="mapbox://styles/cb29/ckxmjckme2if514s0v3xq4vxy">Satellite Streets</option>
Â  Â  Â  Â  Â  Â  Â  <option value="mapbox://styles/cb29/ckxrnuq691z6h14mnuy5jpk5c">Topography Colorful</option>
Â  Â  Â  Â  Â  Â  Â  <option value="mapbox://styles/cb29/ckxnp39kb5eyw14oaan01mkp0">Topography Globe</option>
Â  Â  Â  Â  Â  Â  Â  <option value="mapbox://styles/cb29/ckxnkf6rs60r214uc0j42vbj4">Topography Outdoor</option>
Â  Â  Â  Â  Â  Â  Â  <option value="mapbox://styles/cb29/ckxnqwyww0sri14p9skglgshs">Topography Subtle</option>
Â  Â  Â  Â  Â  Â  Â  <option value="mapbox://styles/cb29/ckxno9jbk3nn714s6vjah6fwb">Topography Vintage</option>
Â  Â  Â  Â  Â  Â  Â  <option value="mapbox://styles/cb29/ckxrrtfqk0oir15my0y9tpjvj">Unique Colorful</option>
Â  Â  Â  Â  Â  Â  Â  <option value="mapbox://styles/cb29/ckxovchyg4tfj14s6d7u559tj">Unique Comic Book 1</option>
Â  Â  Â  Â  Â  Â  Â  <option value="mapbox://styles/cb29/ckxov6vgm66g214o064dp3vda">Unique Comic Book 2</option>
Â  Â  Â  Â  Â  Â  Â  <option value="mapbox://styles/cb29/ckxove5sy174l15mq6h82hwxk">Unique Dusty Western</option>
Â  Â  Â  Â  Â  Â  Â  <option value="mapbox://styles/cb29/ckxoup98z4sv514m0q988ltie">Unique Picture Book</option>
Â  Â  Â  Â  Â  Â  Â  <option value="mapbox://styles/cb29/ckxov1ris0n2415p4e9gn8oxu">Unique Treasure Map</option>
Â  Â  Â  Â  Â  Â  Â  <option value="mapbox://styles/cb29/ckxous4km02k114m523qh0k9y">Unique Woodcut</option>
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  <label class="form-label">Center Map On</label>
Â  Â  Â  Â  Â  Â  <input type="text" class="form-input" id="center-input" placeholder="Enter address or coordinates">
Â  Â  Â  Â  Â  Â  <div class="button-grid">
Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-secondary" onclick="RouteFinderApp.mapControls.centerMapOnLocation()">
Â  Â  Â  Â  Â  Â  Â  Â  â— CenterÂ  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-secondary" onclick="RouteFinderApp.mapControls.toggleCenterMode()" id="center-mode-btn">
Â  Â  Â  Â  Â  Â  Â  Â  â—‰ Click MapÂ  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="button-grid">
Â  Â  Â  Â  Â  Â  <button class="btn btn-secondary" onclick="RouteFinderApp.mapControls.toggleCrosshair()" id="crosshair-toggle">
Â  Â  Â  Â  Â  Â  Â  âŠ• Show CenterÂ  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <button class="btn btn-secondary" onclick="RouteFinderApp.mapControls.getCurrentCenter()">
Â  Â  Â  Â  Â  Â  Â  â§‰ Get CenterÂ  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="zoom-controls">
Â  Â  Â  Â  Â  Â  <button class="btn btn-secondary" onclick="RouteFinderApp.mapControls.zoomIn()">+</button>
Â  Â  Â  Â  Â  Â  <button class="btn btn-secondary" onclick="RouteFinderApp.mapControls.zoomOut()">-</button>
Â  Â  Â  Â  Â  Â  <button class="btn btn-secondary" onclick="RouteFinderApp.mapControls.fitToData()" style="flex: 1; font-size: var(--font-size-sm);">
Â  Â  Â  Â  Â  Â  Â  â¬š Fit to RoutesÂ  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <!-- Initialization Controls -->
Â  Â  Â  <div class="card" id="init-controls">
Â  Â  Â  Â  <div class="card-header">
Â  Â  Â  Â  Â  <div style="display: flex; align-items: center;">
Â  Â  Â  Â  Â  Â  <span class="icon">â—¯</span>
Â  Â  Â  Â  Â  Â  <span>Initialize Application</span>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="card-content">
Â  Â  Â  Â  Â  <button class="btn btn-primary btn-full" onclick="RouteFinderApp.init()" id="init-app-btn">
Â  Â  Â  Â  Â  Â  â†’ Start Route FinderÂ  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  <p style="font-size: var(--font-size-xs); color: var(--color-text-tertiary); margin: var(--space-3) 0 0 0; text-align: center;">
Â  Â  Â  Â  Â  Â  This will load the mapping libraries and start the full application.Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>
Â  <script>
Â  Â  Â  Â  // Main Application Object with Modular Architecture
Â  Â  Â  Â  const RouteFinderApp = (function() {
Â  Â  Â  Â  Â  Â  'use strict';
Â  Â  Â  Â  Â  Â  // Configuration Object - Centralized Settings
Â  Â  Â  Â  Â  Â  const Config = {
Â  Â  Â  Â  Â  Â  Â  Â  // Map Configuration
Â  Â  Â  Â  Â  Â  Â  Â  mapbox: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  accessToken: 'pk.eyJ1IjoiY2IyOSIsImEiOiJja3E4OHo3anowZGx1Mm9tcXF3ZmhyaWtwIn0.IQ5rY622AU9GOETrqa9NBw',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style: 'mapbox://styles/cb29/ckxnnmex53n1b14m07t6sum48', // Classic Standard as default
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  center: [-84.5, 38.05],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  zoom: 10
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Route Configuration
Â  Â  Â  Â  Â  Â  Â  Â  routes: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  colors: ['#ff0000', '#00ff00', '#0066ff', '#ff6600', '#ff00ff', '#00ffff', '#ffff00', '#990000', '#009900', '#000099'],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  defaultWidth: 8,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  defaultProfile: 'driving'
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // UI Configuration
Â  Â  Â  Â  Â  Â  Â  Â  ui: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sidebarTransitionDuration: 300,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusMessageDuration: 5000
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Timing Configuration
Â  Â  Â  Â  Â  Â  Â  Â  timing: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mapLoadDelay: 1000,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  libraryLoadTimeout: 30000,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  geocodingDelay: 500
Â  Â  Â  Â  }Â  Â  Â  Â  
Â  Â  Â  };Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Event System - Centralized Event Management
Â  Â  Â  Â  Â  Â  const EventSystem = {
Â  Â  Â  Â  Â  Â  Â  Â  events: {},
Â  Â  Â  Â  Â  Â  Â  Â  on(event, callback) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!this.events[event]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.events[event] = [];
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.events[event].push(callback);
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  off(event, callback) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!this.events[event]) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.events[event] = this.events[event].filter(cb => cb !== callback);
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  emit(event, data) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!this.events[event]) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.events[event].forEach(callback => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  callback(data);
Â  Â  Â  Â  Â  Â  } Â  Â  Â  Â  Â  Â  catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Event callback error:', error);
Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  }Â  Â  Â  Â  
Â  Â  Â  };Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Application State - Centralized State Management
Â  Â  Â  Â  Â  Â  const State = {
Â  Â  Â  Â  Â  Â  Â  Â  // Core state
Â  Â  Â  Â  Â  Â  Â  Â  map: null,
Â  Â  Â  Â  Â  Â  Â  Â  appInitialized: false,
Â  Â  Â  Â  Â  Â  Â  Â  librariesLoaded: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mapbox: false,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  turf: false
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Route state
Â  Â  Â  Â  Â  Â  Â  Â  routes: new Map(),
Â  Â  Â  Â  Â  Â  Â  Â  currentRouteId: null,
Â  Â  Â  Â  Â  Â  Â  Â  nextRouteId: 1,
Â  Â  Â  Â  Â  Â  Â  Â  routeListVisible: false,
Â  Â  Â  Â  Â  Â  Â  Â  // Interaction state
Â  Â  Â  Â  Â  Â  Â  Â  interactions: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  settingOrigin: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addingWaypoint: false,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  settingMapCenter: false,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  crosshairVisible: false
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // UI state
Â  Â  Â  Â  Â  Â  Â  Â  collapsedSections: new Set(),
Â  Â  Â  Â  Â  Â  Â  Â  // Getters
Â  Â  Â  Â  Â  Â  Â  Â  getCurrentRoute() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return this.routes.get(this.currentRouteId);
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  getAllRoutes() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return Array.from(this.routes.values());
Â  Â  Â  Â  }Â  Â  Â  Â  
Â  Â  Â  };Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Utility Functions
Â  Â  Â  Â  Â  Â  const Utils = {
Â  Â  Â  Â  Â  Â  Â  Â  updateStatus(message, type) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const statusEl = document.getElementById('status-message');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (statusEl) {
Â  Â  Â  Â  Â  Â  statusEl.className Â  Â  Â  Â  Â  Â  = 'status-message status-' + type;
Â  Â  Â  Â  Â  Â  statusEl.innerHTML Â  Â  Â  Â  Â  Â  = message;
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('STATUS: ' + message);
Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  emit('statusUpdated', { message, type });
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  createEmptyRoute(id = null) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const routeId = id || State.nextRouteId++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: routeId,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name: `Route ${routeId}`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  origin: null,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  destination: null,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  waypoints: [],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  profile: Config.routes.defaultProfile,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: Config.routes.colors[(routeId - 1) % Config.routes.colors.length],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: Config.routes.defaultWidth,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  routeData: null,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  visible: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  status: 'empty'
Â  Â  Â  Â  Â  };Â  Â  Â  Â  Â  
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  formatCoordinates(coords, precision = 4) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return `${coords[1].toFixed(precision)}, ${coords[0].toFixed(precision)}`;
Â  Â  Â  Â  }Â  Â  Â  Â  
Â  Â  Â  };Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Map Management Module
Â  Â  Â  Â  Â  Â  const MapManager = {
Â  Â  Â  Â  Â  Â  Â  Â  init() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!State.librariesLoaded.mapbox || !State.librariesLoaded.turf) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error('Required libraries not loaded');
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  updateStatus('<strong>ğŸ—ºï¸ Initializing Map...</strong><br>Creating map instance...', 'loading');
Â  Â  Â  Â  Â  mapboxgl.accessToken Â  Â  Â  Â  Â  = Config.mapbox.accessToken;
Â  Â  Â  Â  Â  State.map Â  Â  Â  Â  Â  = new mapboxgl.Map({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container: 'map',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style: Config.mapbox.style,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  center: Config.mapbox.center,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  zoom: Config.mapbox.zoom
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  State.map.Â  Â  Â  Â  Â  on('load', () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('Map loaded successfully');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.setupMapFeatures();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.setupEventHandlers();
Â  Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  Â  emit('mapLoaded');
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  State.map.Â  Â  Â  Â  Â  on('error', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Map error:', e);
Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  updateStatus('<strong>âŒ Map Error</strong><br>Failed to initialize map', 'error');
Â  Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  Â  emit('mapError', e);
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  setupMapFeatures() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Add obstacles
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const obstacle = turf.buffer(this.getClearanceData(), 0.25, { units: 'kilometers' });
Â  Â  Â  Â  Â  State.map.Â  Â  Â  Â  Â  addSource('obstacles', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'geojson',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: obstacle
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  State.map.Â  Â  Â  Â  Â  addLayer({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: 'obstacles',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'fill',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  source: 'obstacles',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paint: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'fill-color': '#ff0000',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'fill-opacity': 0.3
Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('Map features setup complete');
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  setupEventHandlers() {
Â  Â  Â  Â  Â  State.map.Â  Â  Â  Â  Â  on('click', (e) => EventSystem.emit('mapClicked', e));
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  getClearanceData() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'FeatureCollection',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  features: [
Â  Â  Â  Â  Â  Â  Â  { Â  Â  Â  Â  Â  Â  Â  type: 'Feature', geometry: { type: 'Point', coordinates: [-84.47426, 38.06673] }, properties: { clearance: "13' 2\"" } },
Â  Â  Â  Â  Â  Â  Â  { Â  Â  Â  Â  Â  Â  Â  type: 'Feature', geometry: { type: 'Point', coordinates: [-84.47208, 38.06694] }, properties: { clearance: "13' 7\"" } },
Â  Â  Â  Â  Â  Â  Â  { Â  Â  Â  Â  Â  Â  Â  type: 'Feature', geometry: { type: 'Point', coordinates: [-84.60485, 38.12184] }, properties: { clearance: "13' 7\"" } },
Â  Â  Â  Â  Â  Â  Â  { Â  Â  Â  Â  Â  Â  Â  type: 'Feature', geometry: { type: 'Point', coordinates: [-84.61905, 37.87504] }, properties: { clearance: "12' 0\"" } },
Â  Â  Â  Â  Â  Â  Â  { Â  Â  Â  Â  Â  Â  Â  type: 'Feature', geometry: { type: 'Point', coordinates: [-84.55946, 38.30213] }, properties: { clearance: "13' 6\"" } },
Â  Â  Â  Â  Â  Â  Â  { Â  Â  Â  Â  Â  Â  Â  type: 'Feature', geometry: { type: 'Point', coordinates: [-84.27235, 38.04954] }, properties: { clearance: "13' 6\"" } },
Â  Â  Â  Â  Â  Â  Â  { Â  Â  Â  Â  Â  Â  Â  type: 'Feature', geometry: { type: 'Point', coordinates: [-84.27264, 37.82917] }, properties: { clearance: "11' 6\"" } }
Â  Â  Â  Â  Â  Â  ]Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  };Â  Â  Â  Â  Â  
Â  Â  Â  Â  }Â  Â  Â  Â  
Â  Â  Â  };Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Route Management Module
Â  Â  Â  Â  Â  Â  const RouteManager = {
Â  Â  Â  Â  Â  Â  Â  Â  createNewRoute() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newRoute = Utils.createEmptyRoute();
Â  Â  Â  Â  Â  State.routes.Â  Â  Â  Â  Â  set(newRoute.id, newRoute);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.addRouteToMap(newRoute.id);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.switchToRoute(newRoute.id);
Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  emit('routeCreated', newRoute);
Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  emit('routesUpdated');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log(`Created new route ${newRoute.id}`);
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  addRouteToMap(routeId) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const route = State.routes.get(routeId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!route || !State.map) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Add route line source and layer
Â  Â  Â  Â  Â  State.map.Â  Â  Â  Â  Â  addSource(`route-${routeId}`, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'geojson',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: { type: 'FeatureCollection', features: [] }
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  State.map.Â  Â  Â  Â  Â  addLayer({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: `route-${routeId}`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'line',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  source: `route-${routeId}`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layout: { 'line-join': 'round', 'line-cap': 'round' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paint: {Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'line-color': route.color,Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'line-width': route.width,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'line-opacity': route.visible ? 1 : 0
Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Add waypoints source and layer
Â  Â  Â  Â  Â  State.map.Â  Â  Â  Â  Â  addSource(`waypoints-${routeId}`, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'geojson',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: { type: 'FeatureCollection', features: [] }
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  State.map.Â  Â  Â  Â  Â  addLayer({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: `waypoints-${routeId}`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'circle',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  source: `waypoints-${routeId}`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  paint: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'circle-radius': 6,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'circle-color': ['get', 'color'],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'circle-stroke-color': '#ffffff',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'circle-stroke-width': 2,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'circle-opacity': route.visible ? 1 : 0,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'circle-stroke-opacity': route.visible ? 1 : 0
Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  switchToRoute(routeId) {
Â  Â  Â  Â  Â  State.currentRouteId Â  Â  Â  Â  Â  = routeId;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const route = State.routes.get(routeId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!route) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Update UI
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('origin-input').value = route.origin ? Utils.formatCoordinates(route.origin) : '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('destination-input').value = route.destination ? Utils.formatCoordinates(route.destination) : '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('profile-select').value = route.profile;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('routeColor').value = route.color;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('routeWidth').value = route.width;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('current-route-header').textContent = `ğŸ¯ ${route.name}`;
Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  emit('routeSwitched', route);
Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  emit('waypointsUpdated');
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  updateRouteOnMap(routeId) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const route = State.routes.get(routeId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!route || !State.map) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Update route line
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const routeFeatures = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (route.routeData) {
Â  Â  Â  Â  Â  Â  routeFeatures.Â  Â  Â  Â  Â  Â  push({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'Feature',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  geometry: route.routeData.geometry
Â  Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  State.map.Â  Â  Â  Â  Â  getSource(`route-${routeId}`).setData({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'FeatureCollection',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  features: routeFeatures
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Update waypoints
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const waypointFeatures = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let featureId = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (route.origin) {
Â  Â  Â  Â  Â  Â  waypointFeatures.Â  Â  Â  Â  Â  Â  push({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'Feature',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: featureId++,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  geometry: { type: 'Point', coordinates: route.origin },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  properties: { color: '#00ff00', type: 'origin' }
Â  Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  route.waypoints.Â  Â  Â  Â  Â  forEach((waypoint, index) => {
Â  Â  Â  Â  Â  Â  waypointFeatures.Â  Â  Â  Â  Â  Â  push({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'Feature',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: featureId++,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  geometry: { type: 'Point', coordinates: waypoint },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  properties: { color: '#0066ff', type: 'waypoint', index: index }
Â  Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (route.destination) {
Â  Â  Â  Â  Â  Â  waypointFeatures.Â  Â  Â  Â  Â  Â  push({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'Feature',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: featureId++,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  geometry: { type: 'Point', coordinates: route.destination },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  properties: { color: '#ff0000', type: 'destination' }
Â  Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  State.map.Â  Â  Â  Â  Â  getSource(`waypoints-${routeId}`).setData({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'FeatureCollection',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  features: waypointFeatures
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  deleteRoute(routeId) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (State.routes.size <= 1) {
Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  updateStatus('<strong>âŒ Cannot Delete</strong><br>Must have at least one route', 'error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Remove from map
Â  Â  Â  Â  Â  [Â  Â  Â  Â  Â  'route', 'waypoints'].forEach(type => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const layerId = `${type}-${routeId}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (State.map.getLayer(layerId)) State.map.removeLayer(layerId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (State.map.getSource(layerId)) State.map.removeSource(layerId);
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  State.routes.Â  Â  Â  Â  Â  delete(routeId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Switch to another route if we deleted the current one
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (State.currentRouteId === routeId) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const remainingRoutes = Array.from(State.routes.keys());
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.switchToRoute(remainingRoutes[0]);
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  emit('routeDeleted', routeId);
Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  emit('routesUpdated');
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  clearCurrentRoute() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const route = State.getCurrentRoute();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!route) return;
Â  Â  Â  Â  Â  route.origin Â  Â  Â  Â  Â  = null;
Â  Â  Â  Â  Â  route.destination Â  Â  Â  Â  Â  = null;
Â  Â  Â  Â  Â  route.waypoints Â  Â  Â  Â  Â  = [];
Â  Â  Â  Â  Â  route.routeData Â  Â  Â  Â  Â  = null;
Â  Â  Â  Â  Â  route.status Â  Â  Â  Â  Â  = 'empty';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('origin-input').value = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('destination-input').value = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('waypoint-input').value = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.updateRouteOnMap(State.currentRouteId);
Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  emit('routeCleared', route);
Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  emit('waypointsUpdated');
Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  updateStatus('<strong>ğŸ—‘ï¸ Route Cleared</strong><br>All data removed from current route', 'success');
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  updateCurrentRouteStyle() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const route = State.getCurrentRoute();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!route) return;
Â  Â  Â  Â  Â  route.color Â  Â  Â  Â  Â  = document.getElementById('routeColor').value;
Â  Â  Â  Â  Â  route.width Â  Â  Â  Â  Â  = parseInt(document.getElementById('routeWidth').value);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (State.map.getLayer(`route-${State.currentRouteId}`)) {
Â  Â  Â  Â  Â  Â  State.map.Â  Â  Â  Â  Â  Â  setPaintProperty(`route-${State.currentRouteId}`, 'line-color', route.color);
Â  Â  Â  Â  Â  Â  State.map.Â  Â  Â  Â  Â  Â  setPaintProperty(`route-${State.currentRouteId}`, 'line-width', route.width);
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  emit('routeStyleUpdated', route);
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  toggleRouteVisibility(routeId) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const route = State.routes.get(routeId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!route) return;
Â  Â  Â  Â  Â  route.visible Â  Â  Â  Â  Â  = !route.visible;
Â  Â  Â  Â  Â  [Â  Â  Â  Â  Â  'route', 'waypoints'].forEach(type => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const layerId = `${type}-${routeId}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (State.map.getLayer(layerId)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const opacityProperty = type === 'route' ? 'line-opacity' : 'circle-opacity';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const strokeOpacityProperty = type === 'waypoints' ? 'circle-stroke-opacity' : null;
Â  Â  Â  Â  Â  Â  Â  State.map.Â  Â  Â  Â  Â  Â  Â  setPaintProperty(layerId, opacityProperty, route.visible ? 1 : 0);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (strokeOpacityProperty) {
Â  Â  Â  Â  Â  Â  Â  Â  State.map.Â  Â  Â  Â  Â  Â  Â  Â  setPaintProperty(layerId, strokeOpacityProperty, route.visible ? 1 : 0);
Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  emit('routeVisibilityToggled', route);
Â  Â  Â  Â  }Â  Â  Â  Â  
Â  Â  Â  };Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Geocoding Module
Â  Â  Â  Â  Â  Â  const GeocodingManager = {
Â  Â  Â  Â  Â  Â  Â  Â  geocodeOrigin() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const address = document.getElementById('origin-input').value;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!address.trim()) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.geocodeAddress(address, (coords) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const route = State.getCurrentRoute();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (route) {
Â  Â  Â  Â  Â  Â  Â  route.origin Â  Â  Â  Â  Â  Â  Â  = coords;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('origin-input').value = Utils.formatCoordinates(coords);
Â  Â  Â  Â  Â  Â  Â  RouteManager.Â  Â  Â  Â  Â  Â  Â  updateRouteOnMap(State.currentRouteId);
Â  Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  Â  updateStatus('<strong>âœ… Origin Found</strong><br>Location geocoded successfully', 'success');
Â  Â  Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  Â  Â  emit('originSet', coords);
Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  geocodeDestination() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const address = document.getElementById('destination-input').value;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!address.trim()) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.geocodeAddress(address, (coords) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const route = State.getCurrentRoute();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (route) {
Â  Â  Â  Â  Â  Â  Â  route.destination Â  Â  Â  Â  Â  Â  Â  = coords;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('destination-input').value = Utils.formatCoordinates(coords);
Â  Â  Â  Â  Â  Â  Â  RouteManager.Â  Â  Â  Â  Â  Â  Â  updateRouteOnMap(State.currentRouteId);
Â  Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  Â  updateStatus('<strong>âœ… Destination Found</strong><br>Location geocoded successfully', 'success');
Â  Â  Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  Â  Â  emit('destinationSet', coords);
Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  geocodeAddress(address, callback) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const url = `https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(address)}.json?access_token=${mapboxgl.accessToken}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fetch(url)
Â  Â  Â  Â  Â  Â  .Â  Â  Â  Â  Â  Â  then(response => response.json())
Â  Â  Â  Â  Â  Â  .Â  Â  Â  Â  Â  Â  then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (data.features && data.features.length> 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  callback(data.features[0].center);
Â  Â  Â  Â  Â  Â  Â  } Â  Â  Â  Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  Â  Â  updateStatus('<strong>âŒ Location Not Found</strong><br>Could not geocode the address', 'error');
Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  })Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  .Â  Â  Â  Â  Â  Â  catch(error => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Geocoding error:', error);
Â  Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  Â  updateStatus('<strong>âŒ Geocoding Error</strong><br>Failed to find location', 'error');
Â  Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  }Â  Â  Â  Â  
Â  Â  Â  };Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Waypoint Management Module
Â  Â  Â  Â  Â  Â  const WaypointManager = {
Â  Â  Â  Â  Â  Â  Â  Â  addWaypoint() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const address = document.getElementById('waypoint-input').value;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!address.trim()) return;
Â  Â  Â  Â  Â  GeocodingManager.Â  Â  Â  Â  Â  geocodeAddress(address, (coords) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.addWaypointAtCoordinates(coords);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('waypoint-input').value = '';
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  addWaypointAtCoordinates(coords) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const route = State.getCurrentRoute();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!route) return;
Â  Â  Â  Â  Â  route.waypoints.Â  Â  Â  Â  Â  push(coords);
Â  Â  Â  Â  Â  RouteManager.Â  Â  Â  Â  Â  updateRouteOnMap(State.currentRouteId);
Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  emit('waypointAdded', coords);
Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  updateStatus('<strong>âœ… Waypoint Added</strong><br>Intermediate stop added to route', 'success');
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  removeWaypoint(index) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const route = State.getCurrentRoute();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!route) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const removed = route.waypoints.splice(index, 1)[0];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (route.routeData) {
Â  Â  Â  Â  Â  Â  route.routeData Â  Â  Â  Â  Â  Â  = null;
Â  Â  Â  Â  Â  Â  RouteManager.Â  Â  Â  Â  Â  Â  updateRouteOnMap(State.currentRouteId);
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  emit('waypointRemoved', { index, waypoint: removed });
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  toggleWaypointMode() {
Â  Â  Â  Â  Â  State.interactions.addingWaypoint Â  Â  Â  Â  Â  = !State.interactions.addingWaypoint;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const btn = document.getElementById('waypoint-mode-btn');
Â  Â  Â  Â  Â  btn.textContent Â  Â  Â  Â  Â  = State.interactions.addingWaypoint ? 'ğŸ›‘ Stop Adding' : 'ğŸ“ Click Map';
Â  Â  Â  Â  Â  btn.className Â  Â  Â  Â  Â  = State.interactions.addingWaypoint ? 'btn btn-secondary' : 'btn btn-secondary';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (State.interactions.addingWaypoint) {
Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  updateStatus('<strong>ğŸ“ Waypoint Mode</strong><br>Click on map to add waypoints', 'loading');
Â  Â  Â  Â  Â  } Â  Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  updateStatus('<strong>ğŸ‰ Ready!</strong><br>Multi-route mapper is ready to use', 'success');
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  emit('waypointModeToggled', State.interactions.addingWaypoint);
Â  Â  Â  Â  }Â  Â  Â  Â  
Â  Â  Â  };Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Routing Module
Â  Â  Â  Â  Â  Â  const RoutingManager = {
Â  Â  Â  Â  Â  Â  Â  Â  findRoute() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const route = State.getCurrentRoute();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!route || !route.origin || !route.destination) {
Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  updateStatus('<strong>âŒ Missing Data</strong><br>Need both origin and destination', 'error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  updateStatus('<strong>ğŸ” Finding Route...</strong><br>Calculating best path', 'loading');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let coordinates = [route.origin];
Â  Â  Â  Â  Â  coordinates Â  Â  Â  Â  Â  = coordinates.concat(route.waypoints);
Â  Â  Â  Â  Â  coordinates.Â  Â  Â  Â  Â  push(route.destination);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const coordsString = coordinates.map(coord => `${coord[0]},${coord[1]}`).join(';');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const profile = route.profile;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const url = `https://api.mapbox.com/directions/v5/mapbox/${profile}/${coordsString}?geometries=geojson&access_token=${mapboxgl.accessToken}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fetch(url)
Â  Â  Â  Â  Â  Â  .Â  Â  Â  Â  Â  Â  then(response => response.json())
Â  Â  Â  Â  Â  Â  .Â  Â  Â  Â  Â  Â  then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (data.routes && data.routes.length> 0) {
Â  Â  Â  Â  Â  Â  Â  Â  route.routeData Â  Â  Â  Â  Â  Â  Â  Â  = data.routes[0];
Â  Â  Â  Â  Â  Â  Â  Â  route.status Â  Â  Â  Â  Â  Â  Â  Â  = 'calculated';
Â  Â  Â  Â  Â  Â  Â  Â  RouteManager.Â  Â  Â  Â  Â  Â  Â  Â  updateRouteOnMap(State.currentRouteId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const duration = Math.round(route.routeData.duration / 60);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const distance = (route.routeData.distance / 1000).toFixed(1);
Â  Â  Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  Â  Â  updateStatus(`<strong>âœ… Route Found!</strong><br>${duration} minutes, ${distance} km`, 'success');
Â  Â  Â  Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  Â  Â  Â  emit('routeCalculated', route);
Â  Â  Â  Â  Â  Â  Â  } Â  Â  Â  Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  Â  Â  updateStatus('<strong>âŒ No Route Found</strong><br>Could not calculate route', 'error');
Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  })Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  .Â  Â  Â  Â  Â  Â  catch(error => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Routing error:', error);
Â  Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  Â  updateStatus('<strong>âŒ Routing Error</strong><br>Failed to calculate route', 'error');
Â  Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  }Â  Â  Â  Â  
Â  Â  Â  };Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Map Controls Module
Â  Â  Â  Â  Â  Â  const MapControlsManager = {
Â  Â  Â  Â  Â  Â  Â  Â  zoomIn() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (State.map) State.map.zoomIn();
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  zoomOut() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (State.map) State.map.zoomOut();
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  fitToData() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!State.map) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const coordinates = [];
Â  Â  Â  Â  Â  State.routes.Â  Â  Â  Â  Â  forEach(route => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (route.visible && route.routeData) {
Â  Â  Â  Â  Â  Â  Â  coordinates.Â  Â  Â  Â  Â  Â  Â  push(...route.routeData.geometry.coordinates);
Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (coordinates.length === 0) {
Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  updateStatus('<strong>â„¹ï¸ No Data</strong><br>No visible routes to fit to', 'loading');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const bounds = coordinates.reduce((bounds, coord) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return bounds.extend(coord);
Â  Â  Â  Â  Â  }, Â  Â  Â  Â  Â  new mapboxgl.LngLatBounds(coordinates[0], coordinates[0]));
Â  Â  Â  Â  Â  State.map.Â  Â  Â  Â  Â  fitBounds(bounds, { padding: 50 });
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  toggleCrosshair() {
Â  Â  Â  Â  Â  State.interactions.crosshairVisible Â  Â  Â  Â  Â  = !State.interactions.crosshairVisible;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const crosshair = document.getElementById('map-crosshair');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const toggleBtn = document.getElementById('crosshair-toggle');
Â  Â  Â  Â  Â  crosshair.style.display Â  Â  Â  Â  Â  = State.interactions.crosshairVisible ? 'block' : 'none';
Â  Â  Â  Â  Â  toggleBtn.textContent Â  Â  Â  Â  Â  = State.interactions.crosshairVisible ? 'ğŸ¯ Hide Center' : 'ğŸ¯ Show Center';
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  centerMapOnLocation() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const input = document.getElementById('center-input').value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!input) {
Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  updateStatus('<strong>âŒ No Input</strong><br>Please enter an address or coordinates', 'error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const coordMatch = input.match(/^(-?\d+\.?\d*),\s*(-?\d+\.?\d*)$/);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (coordMatch) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lat = parseFloat(coordMatch[1]);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lng = parseFloat(coordMatch[2]);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (lat>= -90 && lat <= 90 && lng>= -180 && lng <= 180) {
Â  Â  Â  Â  Â  Â  Â  State.map.Â  Â  Â  Â  Â  Â  Â  flyTo({ center: [lng, lat], zoom: 14, duration: 2000 });
Â  Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  Â  updateStatus(`<strong>ğŸ“ Map Centered</strong><br>Coordinates: ${lat.toFixed(4)}, ${lng.toFixed(4)}`, 'success');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  updateStatus('<strong>ğŸ” Finding Location...</strong><br>Searching for address', 'loading');
Â  Â  Â  Â  Â  GeocodingManager.Â  Â  Â  Â  Â  geocodeAddress(input, (coords) => {
Â  Â  Â  Â  Â  Â  State.map.Â  Â  Â  Â  Â  Â  flyTo({ center: coords, zoom: 14, duration: 2000 });
Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  updateStatus(`<strong>ğŸ“ Map Centered</strong><br>Location found and centered`, 'success');
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  toggleCenterMode() {
Â  Â  Â  Â  Â  State.interactions.settingMapCenter Â  Â  Â  Â  Â  = !State.interactions.settingMapCenter;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const btn = document.getElementById('center-mode-btn');
Â  Â  Â  Â  Â  btn.textContent Â  Â  Â  Â  Â  = State.interactions.settingMapCenter ? 'ğŸ›‘ Stop Mode' : 'ğŸ“ Click Map';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (State.interactions.settingMapCenter) {
Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  updateStatus('<strong>ğŸ“ Center Mode</strong><br>Click on map to center at that location', 'loading');
Â  Â  Â  Â  Â  } Â  Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  updateStatus('<strong>ğŸ‰ Ready!</strong><br>Multi-route mapper is ready to use', 'success');
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  getCurrentCenter() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!State.map) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const center = State.map.getCenter();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const centerText = `${center.lat.toFixed(6)}, ${center.lng.toFixed(6)}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (navigator.clipboard) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  navigator.clipboard.writeText(centerText).then(() => {
Â  Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  Â  updateStatus(`<strong>ğŸ“‹ Center Copied</strong><br>${centerText}`, 'success');
Â  Â  Â  Â  Â  Â  }).Â  Â  Â  Â  Â  Â  catch(() => {
Â  Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  Â  updateStatus(`<strong>ğŸ“ Map Center</strong><br>${centerText}`, 'success');
Â  Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  } Â  Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  updateStatus(`<strong>ğŸ“ Map Center</strong><br>${centerText}`, 'success');
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('center-input').value = centerText;
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  changeMapStyle() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!State.map) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const selectedStyle = document.getElementById('map-style-select').value;
Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  updateStatus('<strong>ğŸ¨ Changing Map Style...</strong><br>Loading new style', 'loading');
Â  Â  Â  Â  Â  State.map.Â  Â  Â  Â  Â  setStyle(selectedStyle);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Re-add custom layers after style loads
Â  Â  Â  Â  Â  State.map.Â  Â  Â  Â  Â  once('style.load', () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Re-add obstacles layer
Â  Â  Â  Â  Â  Â  MapManager.Â  Â  Â  Â  Â  Â  setupMapFeatures();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Re-add all route layers
Â  Â  Â  Â  Â  Â  State.routes.Â  Â  Â  Â  Â  Â  forEach((route, routeId) => {
Â  Â  Â  Â  Â  Â  Â  RouteManager.Â  Â  Â  Â  Â  Â  Â  addRouteToMap(routeId);
Â  Â  Â  Â  Â  Â  Â  RouteManager.Â  Â  Â  Â  Â  Â  Â  updateRouteOnMap(routeId);
Â  Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  updateStatus('<strong>âœ… Map Style Changed</strong><br>Style updated successfully', 'success');
Â  Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  Â  emit('mapStyleChanged', selectedStyle);
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  }Â  Â  Â  Â  
Â  Â  Â  };Â  Â  Â  
Â  Â  Â  Â  Â  Â  // File Management Module
Â  Â  Â  Â  Â  Â  const FileManager = {
Â  Â  Â  Â  Â  Â  Â  Â  exportRoutes() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (State.routes.size === 0) {
Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  updateStatus('<strong>âŒ No Routes</strong><br>No routes to export', 'error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const exportData = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  version: "1.0",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  exportDate: new Date().toISOString(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  totalRoutes: State.routes.size,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  routes: State.getAllRoutes().map(route => ({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: route.id,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name: route.name,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  origin: route.origin,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  destination: route.destination,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  waypoints: route.waypoints,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  profile: route.profile,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: route.color,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: route.width,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  visible: route.visible,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  status: route.status,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  routeStats: route.routeData ? {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  duration: route.routeData.duration,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  distance: route.routeData.distance
Â  Â  Â  Â  Â  Â  Â  Â  } Â  Â  Â  Â  Â  Â  Â  Â  : null
Â  Â  Â  Â  Â  Â  Â  }))Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  };Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dataStr = JSON.stringify(exportData, null, 2);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dataBlob = new Blob([dataStr], { type: 'application/json' });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const link = document.createElement('a');
Â  Â  Â  Â  Â  Â  link.href Â  Â  Â  Â  Â  Â  = URL.createObjectURL(dataBlob);
Â  Â  Â  Â  Â  Â  link.download Â  Â  Â  Â  Â  Â  = `routes_export_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.body.appendChild(link);
Â  Â  Â  Â  Â  Â  link.Â  Â  Â  Â  Â  Â  click();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.body.removeChild(link);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  URL.revokeObjectURL(link.href);
Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  updateStatus(`<strong>ğŸ“¤ Routes Exported</strong><br>Downloaded ${State.routes.size} routes successfully`, 'success');
Â  Â  Â  Â  Â  } Â  Â  Â  Â  Â  catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Export error:', error);
Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  updateStatus('<strong>âŒ Export Failed</strong><br>Could not export routes', 'error');
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  triggerImportRoutes() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('import-file-input').click();
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  importRoutes(event) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const file = event.target.files[0];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!file) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!file.name.endsWith('.json')) {
Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  updateStatus('<strong>âŒ Invalid File</strong><br>Please select a JSON file', 'error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  Â  reader.onload Â  Â  Â  Â  Â  = (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const importData = JSON.parse(e.target.result);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!importData.routes || !Array.isArray(importData.routes)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error('Invalid route data structure');
Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  Â  updateStatus('<strong>ğŸ“¥ Importing Routes...</strong><br>Processing route data', 'loading');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (State.routes.size> 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const confirmClear = confirm(`This will replace your current ${State.routes.size} route(s). Continue?`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!confirmClear) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  Â  Â  Â  updateStatus('<strong>âŒ Import Cancelled</strong><br>Existing routes preserved', 'error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Clear existing routes
Â  Â  Â  Â  Â  Â  Â  State.routes.Â  Â  Â  Â  Â  Â  Â  forEach((route, id) => {
Â  Â  Â  Â  Â  Â  Â  Â  [Â  Â  Â  Â  Â  Â  Â  Â  'route', 'waypoints'].forEach(type => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const layerId = `${type}-${id}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (State.map.getLayer(layerId)) State.map.removeLayer(layerId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (State.map.getSource(layerId)) State.map.removeSource(layerId);
Â  Â  Â  Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  State.routes.Â  Â  Â  Â  Â  Â  Â  clear();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Import new routes
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let importedCount = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let maxId = 0;
Â  Â  Â  Â  Â  Â  Â  importData.routes.Â  Â  Â  Â  Â  Â  Â  forEach(routeData => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newRoute = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: routeData.id,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name: routeData.name || `Route ${routeData.id}`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  origin: routeData.origin || null,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  destination: routeData.destination || null,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  waypoints: routeData.waypoints || [],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  profile: routeData.profile || 'driving',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: routeData.color || Config.routes.colors[routeData.id % Config.routes.colors.length],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: routeData.width || 8,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  visible: routeData.visible !== undefined ? routeData.visible : true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  status: routeData.status || 'empty',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  routeData: null
Â  Â  Â  Â  Â  Â  Â  Â  };Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  State.routes.Â  Â  Â  Â  Â  Â  Â  Â  set(newRoute.id, newRoute);
Â  Â  Â  Â  Â  Â  Â  Â  RouteManager.Â  Â  Â  Â  Â  Â  Â  Â  addRouteToMap(newRoute.id);
Â  Â  Â  Â  Â  Â  Â  Â  maxId Â  Â  Â  Â  Â  Â  Â  Â  = Math.max(maxId, newRoute.id);
Â  Â  Â  Â  Â  Â  Â  Â  importedCountÂ  Â  Â  Â  Â  Â  Â  Â  ++;
Â  Â  Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  State.nextRouteId Â  Â  Â  Â  Â  Â  Â  = maxId + 1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (State.routes.size> 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const firstRouteId = Array.from(State.routes.keys())[0];
Â  Â  Â  Â  Â  Â  Â  Â  RouteManager.Â  Â  Â  Â  Â  Â  Â  Â  switchToRoute(firstRouteId);
Â  Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  Â  Â  emit('routesImported', importedCount);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const importInfo = importData.exportDate ?Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  `Â  Â  Â  Â  Â  Â  Â  Â  <br>From: ${new Date(importData.exportDate).toLocaleDateString()}` : '';
Â  Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  Â  updateStatus(`<strong>ğŸ“¥ Import Complete</strong><br>Imported ${importedCount} routes${importInfo}`, 'success');
Â  Â  Â  Â  Â  Â  } Â  Â  Â  Â  Â  Â  catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Import error:', error);
Â  Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  Â  updateStatus('<strong>âŒ Import Failed</strong><br>Invalid or corrupted file', 'error');
Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  };Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  reader.onerror Â  Â  Â  Â  Â  = () => {
Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  updateStatus('<strong>âŒ File Read Error</strong><br>Could not read the file', 'error');
Â  Â  Â  Â  Â  };Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  reader.Â  Â  Â  Â  Â  readAsText(file);
Â  Â  Â  Â  Â  event.target.value Â  Â  Â  Â  Â  = '';
Â  Â  Â  Â  }Â  Â  Â  Â  
Â  Â  Â  };Â  Â  Â  
Â  Â  Â  Â  Â  Â  // UI Management Module
Â  Â  Â  Â  Â  Â  const UIManager = {
Â  Â  Â  Â  Â  Â  Â  Â  init() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.setupEventListeners();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.setupCollapsibleSections();
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  setupEventListeners() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Route events
Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  on('routeCreated', () => this.updateRouteTabs());
Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  on('routeDeleted', () => this.updateRouteTabs());
Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  on('routesUpdated', () => this.updateRouteList());
Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  on('routeSwitched', () => this.updateRouteTabs());
Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  on('waypointsUpdated', () => this.updateWaypointsList());
Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  on('waypointAdded', () => this.updateWaypointsList());
Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  on('waypointRemoved', () => this.updateWaypointsList());
Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  on('mapLoaded', () => this.showApplicationUI());
Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  on('routesImported', () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.updateRouteTabs();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.updateRouteList();
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  setupCollapsibleSections() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Initialize all sections as expanded
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const sections = ['route-management', 'current-route', 'map-controls'];
Â  Â  Â  Â  Â  sections.Â  Â  Â  Â  Â  forEach(sectionId => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const header = document.querySelector(`#${sectionId} .card-header`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const content = document.querySelector(`#${sectionId}-content`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (header && content) {
Â  Â  Â  Â  Â  Â  Â  header.Â  Â  Â  Â  Â  Â  Â  setAttribute('data-section', sectionId);
Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  toggleSection(sectionId) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const header = document.querySelector(`[data-section="${sectionId}"]`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const content = document.getElementById(`${sectionId}-content`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const chevron = header?.querySelector('.chevron');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!header || !content || !chevron) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isCollapsed = State.collapsedSections.has(sectionId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (isCollapsed) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Expand
Â  Â  Â  Â  Â  Â  State.collapsedSections.Â  Â  Â  Â  Â  Â  delete(sectionId);
Â  Â  Â  Â  Â  Â  header.classList.Â  Â  Â  Â  Â  Â  remove('collapsed');
Â  Â  Â  Â  Â  Â  content.classList.Â  Â  Â  Â  Â  Â  remove('collapsed');
Â  Â  Â  Â  Â  Â  chevron.textContent Â  Â  Â  Â  Â  Â  = 'â–½';
Â  Â  Â  Â  Â  } Â  Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Collapse
Â  Â  Â  Â  Â  Â  State.collapsedSections.Â  Â  Â  Â  Â  Â  add(sectionId);
Â  Â  Â  Â  Â  Â  header.classList.Â  Â  Â  Â  Â  Â  add('collapsed');
Â  Â  Â  Â  Â  Â  content.classList.Â  Â  Â  Â  Â  Â  add('collapsed');
Â  Â  Â  Â  Â  Â  chevron.textContent Â  Â  Â  Â  Â  Â  = 'â–·';
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  showApplicationUI() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('init-controls').style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('route-management').style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('current-route-panel').style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('map-controls').style.display = 'block';
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  updateRouteTabs() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tabsContainer = document.getElementById('route-tabs');
Â  Â  Â  Â  Â  tabsContainer.innerHTML Â  Â  Â  Â  Â  = '';
Â  Â  Â  Â  Â  State.routes.Â  Â  Â  Â  Â  forEach((route, id) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tab = document.createElement('div');
Â  Â  Â  Â  Â  Â  tab.className Â  Â  Â  Â  Â  Â  = `route-tab ${id === State.currentRouteId ? 'active' : ''}`;
Â  Â  Â  Â  Â  Â  tab.innerHTML Â  Â  Â  Â  Â  Â  = `
Â  Â  Â  Â  Â  Â  Â  <div class="color-indicator" style="background-color: ${route.color}"></div>Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  <span>${route.name}</span>Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  <button class="close-btn" onclick="event.stopPropagation(); RouteFinderApp.routes.deleteRoute(${id})" title="Delete route">Ã—</button>Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  `;Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  tab.onclick Â  Â  Â  Â  Â  Â  = () => RouteManager.switchToRoute(id);
Â  Â  Â  Â  Â  Â  tabsContainer.Â  Â  Â  Â  Â  Â  appendChild(tab);
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const toggleBtn = document.getElementById('route-list-toggle');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (State.routes.size> 1) {
Â  Â  Â  Â  Â  Â  toggleBtn.style.display Â  Â  Â  Â  Â  Â  = 'block';
Â  Â  Â  Â  Â  } Â  Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  toggleBtn.style.display Â  Â  Â  Â  Â  Â  = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('route-list').style.display = 'none';
Â  Â  Â  Â  Â  Â  State.routeListVisible Â  Â  Â  Â  Â  Â  = false;
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  updateRouteList() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const listContainer = document.getElementById('route-list');
Â  Â  Â  Â  Â  listContainer.innerHTML Â  Â  Â  Â  Â  = '';
Â  Â  Â  Â  Â  State.routes.Â  Â  Â  Â  Â  forEach((route, id) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const item = document.createElement('div');
Â  Â  Â  Â  Â  Â  item.className Â  Â  Â  Â  Â  Â  = 'route-list-item';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const statusText = this.getRouteStatusText(route);
Â  Â  Â  Â  Â  Â  item.innerHTML Â  Â  Â  Â  Â  Â  = `
Â  Â  Â  Â  Â  Â  Â  <div class="color-indicator" style="background-color: ${route.color}; width: 16px; height: 16px; margin-right: 10px; border-radius: 50%; border: 1px solid rgba(0,0,0,0.2);"></div>Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  <div class="route-info">Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <div class="route-name">${route.name}</div>Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <div class="route-status">${statusText}</div>Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  </div>Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  <div class="route-controls">Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <button class="visibility-btn ${route.visible ? '' : 'hidden'}" onclick="RouteFinderApp.routes.toggleRouteVisibility(${id})" title="Toggle visibility">Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  ${route.visible ? 'â—‰' : 'â—‹'}Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  </button>Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-small" onclick="RouteFinderApp.routes.switchToRoute(${id})" title="Edit route">âœ</button>Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-small" onclick="RouteFinderApp.routes.deleteRoute(${id})" title="Delete route">âœ•</button>Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  </div>Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  `;Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  listContainer.Â  Â  Â  Â  Â  Â  appendChild(item);
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  updateWaypointsList() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const route = State.getCurrentRoute();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!route) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const waypointsList = document.getElementById('waypoint-list');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (route.waypoints.length === 0) {
Â  Â  Â  Â  Â  Â  waypointsList.style.display Â  Â  Â  Â  Â  Â  = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  waypointsList.style.display Â  Â  Â  Â  Â  = 'block';
Â  Â  Â  Â  Â  waypointsList.innerHTML Â  Â  Â  Â  Â  = '';
Â  Â  Â  Â  Â  route.waypoints.Â  Â  Â  Â  Â  forEach((waypoint, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const item = document.createElement('div');
Â  Â  Â  Â  Â  Â  item.className Â  Â  Â  Â  Â  Â  = 'waypoint-item';
Â  Â  Â  Â  Â  Â  item.innerHTML Â  Â  Â  Â  Â  Â  = `
Â  Â  Â  Â  Â  Â  Â  <div class="waypoint-number">${index + 1}</div>Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  <div class="waypoint-text">${Utils.formatCoordinates(waypoint)}</div>Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  <div class="waypoint-controls">Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-secondary btn-small" onclick="RouteFinderApp.waypoints.removeWaypoint(${index})" title="Remove waypoint">âœ•</button>Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  </div>Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  `;Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  waypointsList.Â  Â  Â  Â  Â  Â  appendChild(item);
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  getRouteStatusText(route) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!route.origin && !route.destination) return 'Empty route';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!route.origin) return 'Missing origin';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!route.destination) return 'Missing destination';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (route.routeData) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const duration = Math.round(route.routeData.duration / 60);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const distance = (route.routeData.distance / 1000).toFixed(1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return `${duration} min, ${distance} km`;
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return 'Ready to calculate';
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  toggleSidebar() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const sidebar = document.getElementById('sidebar');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const toggleBtn = document.getElementById('toggle-btn');
Â  Â  Â  Â  Â  sidebar.classList.Â  Â  Â  Â  Â  toggle('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (sidebar.classList.contains('hidden')) {
Â  Â  Â  Â  Â  Â  toggleBtn.classList.Â  Â  Â  Â  Â  Â  remove('sidebar-visible');
Â  Â  Â  Â  Â  Â  toggleBtn.classList.Â  Â  Â  Â  Â  Â  add('sidebar-hidden');
Â  Â  Â  Â  Â  } Â  Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  toggleBtn.classList.Â  Â  Â  Â  Â  Â  remove('sidebar-hidden');
Â  Â  Â  Â  Â  Â  toggleBtn.classList.Â  Â  Â  Â  Â  Â  add('sidebar-visible');
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  toggleRouteList() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const listContainer = document.getElementById('route-list');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const toggleBtn = document.getElementById('route-list-toggle');
Â  Â  Â  Â  Â  State.routeListVisible Â  Â  Â  Â  Â  = !State.routeListVisible;
Â  Â  Â  Â  Â  listContainer.style.display Â  Â  Â  Â  Â  = State.routeListVisible ? 'block' : 'none';
Â  Â  Â  Â  Â  toggleBtn.textContent Â  Â  Â  Â  Â  = State.routeListVisible ? 'â‹¯ Hide Routes' : 'â‹¯ Show All Routes';
Â  Â  Â  Â  }Â  Â  Â  Â  
Â  Â  Â  };Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Library Loader Module
Â  Â  Â  Â  Â  Â  const LibraryLoader = {
Â  Â  Â  Â  Â  Â  Â  Â  async loadLibraries() {
Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  updateStatus('<strong>ğŸ“¥ Loading Libraries...</strong><br>Downloading Mapbox GL and Turf.js...', 'loading');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await this.loadMapboxGL();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await this.loadTurf();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return true;
Â  Â  Â  Â  Â  } Â  Â  Â  Â  Â  catch (error) {
Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  updateStatus('<strong>âŒ Failed to Load</strong><br>Could not load required libraries', 'error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  loadMapboxGL() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return new Promise((resolve, reject) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const script = document.createElement('script');
Â  Â  Â  Â  Â  Â  script.src Â  Â  Â  Â  Â  Â  = 'https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js';
Â  Â  Â  Â  Â  Â  script.crossOrigin Â  Â  Â  Â  Â  Â  = 'anonymous';
Â  Â  Â  Â  Â  Â  script.onload Â  Â  Â  Â  Â  Â  = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const css = document.createElement('link');
Â  Â  Â  Â  Â  Â  Â  css.rel Â  Â  Â  Â  Â  Â  Â  = 'stylesheet';
Â  Â  Â  Â  Â  Â  Â  css.href Â  Â  Â  Â  Â  Â  Â  = 'https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css';
Â  Â  Â  Â  Â  Â  Â  css.crossOrigin Â  Â  Â  Â  Â  Â  Â  = 'anonymous';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.head.appendChild(css);
Â  Â  Â  Â  Â  Â  Â  State.librariesLoaded.mapbox Â  Â  Â  Â  Â  Â  Â  = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('Mapbox GL loaded');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resolve();
Â  Â  Â  Â  Â  Â  };Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  script.onerror Â  Â  Â  Â  Â  Â  = reject;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.head.appendChild(script);
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  loadTurf() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return new Promise((resolve, reject) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const script = document.createElement('script');
Â  Â  Â  Â  Â  Â  script.src Â  Â  Â  Â  Â  Â  = 'https://unpkg.com/@turf/turf@6/turf.min.js';
Â  Â  Â  Â  Â  Â  script.crossOrigin Â  Â  Â  Â  Â  Â  = 'anonymous';
Â  Â  Â  Â  Â  Â  script.onload Â  Â  Â  Â  Â  Â  = () => {
Â  Â  Â  Â  Â  Â  Â  State.librariesLoaded.turf Â  Â  Â  Â  Â  Â  Â  = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('Turf.js loaded');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resolve();
Â  Â  Â  Â  Â  Â  };Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  script.onerror Â  Â  Â  Â  Â  Â  = reject;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.head.appendChild(script);
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  }Â  Â  Â  Â  
Â  Â  Â  };Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Map Click Handler
Â  Â  Â  Â  Â  Â  const MapClickHandler = {
Â  Â  Â  Â  Â  Â  Â  Â  init() {
Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  on('mapLoaded', () => {
Â  Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  Â  on('mapClicked', this.handleMapClick.bind(this));
Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  handleMapClick(e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!State.appInitialized) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const coords = [e.lngLat.lng, e.lngLat.lat];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (State.interactions.settingMapCenter) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.handleCenterMapClick(coords);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (State.interactions.addingWaypoint) {
Â  Â  Â  Â  Â  Â  WaypointManager.Â  Â  Â  Â  Â  Â  addWaypointAtCoordinates(coords);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const route = State.getCurrentRoute();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!route) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (State.interactions.settingOrigin) {
Â  Â  Â  Â  Â  Â  route.origin Â  Â  Â  Â  Â  Â  = coords;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('origin-input').value = Utils.formatCoordinates(coords);
Â  Â  Â  Â  Â  Â  State.interactions.settingOrigin Â  Â  Â  Â  Â  Â  = false;
Â  Â  Â  Â  Â  Â  RouteManager.Â  Â  Â  Â  Â  Â  updateRouteOnMap(State.currentRouteId);
Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  updateStatus('<strong>âœ… Origin Set</strong><br>Click on map to set destination', 'success');
Â  Â  Â  Â  Â  } Â  Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  route.destination Â  Â  Â  Â  Â  Â  = coords;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('destination-input').value = Utils.formatCoordinates(coords);
Â  Â  Â  Â  Â  Â  State.interactions.settingOrigin Â  Â  Â  Â  Â  Â  = true;
Â  Â  Â  Â  Â  Â  RouteManager.Â  Â  Â  Â  Â  Â  updateRouteOnMap(State.currentRouteId);
Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  updateStatus('<strong>âœ… Destination Set</strong><br>Ready to find route', 'success');
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  emit('waypointsUpdated');
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  handleCenterMapClick(coords) {
Â  Â  Â  Â  Â  State.map.Â  Â  Â  Â  Â  flyTo({ center: coords, duration: 1500 });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('center-input').value = Utils.formatCoordinates(coords, 6);
Â  Â  Â  Â  Â  State.interactions.settingMapCenter Â  Â  Â  Â  Â  = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const btn = document.getElementById('center-mode-btn');
Â  Â  Â  Â  Â  btn.textContent Â  Â  Â  Â  Â  = 'ğŸ“ Click Map';
Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  updateStatus('<strong>ğŸ“ Map Centered</strong><br>Map centered on clicked location', 'success');
Â  Â  Â  Â  }Â  Â  Â  Â  
Â  Â  Â  };Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Main Application Initialization
Â  Â  Â  Â  Â  Â  const App = {
Â  Â  Â  Â  Â  Â  Â  Â  async init() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('=== Multi-Route Mapper Starting ===');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Load required libraries
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const librariesLoaded = await LibraryLoader.loadLibraries();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!librariesLoaded) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error('Failed to load required libraries');
Â  Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Initialize UI event system
Â  Â  Â  Â  Â  Â  UIManager.Â  Â  Â  Â  Â  Â  init();
Â  Â  Â  Â  Â  Â  MapClickHandler.Â  Â  Â  Â  Â  Â  init();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Initialize map
Â  Â  Â  Â  Â  Â  MapManager.Â  Â  Â  Â  Â  Â  init();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Set up completion handler
Â  Â  Â  Â  Â  Â  EventSystem.Â  Â  Â  Â  Â  Â  on('mapLoaded', () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  RouteManager.Â  Â  Â  Â  Â  Â  Â  Â  createNewRoute();
Â  Â  Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  Â  Â  updateStatus('<strong>ğŸ‰ Ready!</strong><br>Multi-route mapper is ready to use', 'success');
Â  Â  Â  Â  Â  Â  Â  Â  State.appInitialized Â  Â  Â  Â  Â  Â  Â  Â  = true;
Â  Â  Â  Â  Â  Â  Â  }, Config.timing.mapLoadDelay);Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  });Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  } Â  Â  Â  Â  Â  catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Initialization error:', error);
Â  Â  Â  Â  Â  Â  Utils.Â  Â  Â  Â  Â  Â  updateStatus('<strong>âŒ Initialization Failed</strong><br>' + error.message, 'error');
Â  Â  Â  Â  Â  }Â  Â  Â  Â  Â  
Â  Â  Â  Â  }Â  Â  Â  Â  
Â  Â  Â  };Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Public API - Expose modules for HTML onclick handlers
Â  Â  Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  Â  Â  // Core initialization
Â  Â  Â  Â  Â  Â  Â  Â  init: App.init,
Â  Â  Â  Â  Â  Â  Â  Â  // Module access for HTML onclick handlers
Â  Â  Â  Â  Â  Â  Â  Â  routes: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createNewRoute: RouteManager.createNewRoute.bind(RouteManager),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  deleteRoute: RouteManager.deleteRoute.bind(RouteManager),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  switchToRoute: RouteManager.switchToRoute.bind(RouteManager),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  clearCurrentRoute: RouteManager.clearCurrentRoute.bind(RouteManager),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateCurrentRouteStyle: RouteManager.updateCurrentRouteStyle.bind(RouteManager),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toggleRouteVisibility: RouteManager.toggleRouteVisibility.bind(RouteManager)
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  geocoding: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  geocodeOrigin: GeocodingManager.geocodeOrigin.bind(GeocodingManager),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  geocodeDestination: GeocodingManager.geocodeDestination.bind(GeocodingManager)
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  waypoints: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addWaypoint: WaypointManager.addWaypoint.bind(WaypointManager),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  removeWaypoint: WaypointManager.removeWaypoint.bind(WaypointManager),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toggleWaypointMode: WaypointManager.toggleWaypointMode.bind(WaypointManager)
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  routing: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  findRoute: RoutingManager.findRoute.bind(RoutingManager)
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  mapControls: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  zoomIn: MapControlsManager.zoomIn.bind(MapControlsManager),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  zoomOut: MapControlsManager.zoomOut.bind(MapControlsManager),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fitToData: MapControlsManager.fitToData.bind(MapControlsManager),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toggleCrosshair: MapControlsManager.toggleCrosshair.bind(MapControlsManager),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  centerMapOnLocation: MapControlsManager.centerMapOnLocation.bind(MapControlsManager),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toggleCenterMode: MapControlsManager.toggleCenterMode.bind(MapControlsManager),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  getCurrentCenter: MapControlsManager.getCurrentCenter.bind(MapControlsManager),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  changeMapStyle: MapControlsManager.changeMapStyle.bind(MapControlsManager)
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  fileManager: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  exportRoutes: FileManager.exportRoutes.bind(FileManager),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  triggerImportRoutes: FileManager.triggerImportRoutes.bind(FileManager),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  importRoutes: FileManager.importRoutes.bind(FileManager)
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  ui: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toggleSidebar: UIManager.toggleSidebar.bind(UIManager),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toggleRouteList: UIManager.toggleRouteList.bind(UIManager),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toggleSection: UIManager.toggleSection.bind(UIManager)
Â  Â  Â  Â  },Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Development/debugging access
Â  Â  Â  Â  Â  Â  Â  Â  _internal: {
Â  Â  Â  Â  Â  Config,Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  State,Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  EventSystem,Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  UtilsÂ  Â  Â  Â  Â  
Â  Â  Â  Â  }Â  Â  Â  Â  
Â  Â  Â  };Â  Â  Â  
Â     })();    
        // Initialize when page loads
        window.addEventListener('load', function() {
            console.log('Page loaded, ready for initialization');
    });    

    // Monoline SVG Icons - Style Option 2: Medium Weight Rounded
    const MonolineIcons = {
      hamburger: `<svg class="monoline-icon" viewBox="0 0 24 24"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>`,
      
      chevronRight: `<svg class="monoline-icon" viewBox="0 0 24 24"><polyline points="9,18 15,12 9,6"/></svg>`,
      
      route: `<svg class="monoline-icon" viewBox="0 0 24 24"><path d="M6 12c0-3 2-5 4-5s4 2 4 5-2 5-4 5-4-2-4-5z"/><circle cx="6" cy="12" r="1"/><circle cx="18" cy="12" r="1"/></svg>`,
      
      plus: `<svg class="monoline-icon" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>`,
      
      arrowUp: `<svg class="monoline-icon" viewBox="0 0 24 24"><line x1="12" y1="19" x2="12" y2="5"/><polyline points="5,12 12,5 19,12"/></svg>`,
      
      arrowDown: `<svg class="monoline-icon" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><polyline points="19,12 12,19 5,12"/></svg>`,
      
      moreHorizontal: `<svg class="monoline-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>`,
      
      circle: `<svg class="monoline-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/></svg>`,
      
      target: `<svg class="monoline-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>`,
      
      mapPin: `<svg class="monoline-icon" viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>`,
      
      arrowRight: `<svg class="monoline-icon" viewBox="0 0 24 24"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12,5 19,12 12,19"/></svg>`,
      
      x: `<svg class="monoline-icon" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>`,
      
      diamond: `<svg class="monoline-icon" viewBox="0 0 24 24"><polygon points="12,2 22,12 12,22 2,12"/></svg>`,
      
      crosshair: `<svg class="monoline-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="22" y1="12" x2="18" y2="12"/><line x1="6" y1="12" x2="2" y2="12"/><line x1="12" y1="6" x2="12" y2="2"/><line x1="12" y1="22" x2="12" y2="18"/></svg>`,
      
      square: `<svg class="monoline-icon" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/></svg>`,
      
      zoomIn: `<svg class="monoline-icon" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/><line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/></svg>`,
      
      zoomOut: `<svg class="monoline-icon" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/><line x1="8" y1="11" x2="14" y2="11"/></svg>`,
      
      maximize: `<svg class="monoline-icon" viewBox="0 0 24 24"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>`,
      
      loader: `<svg class="monoline-icon" viewBox="0 0 24 24"><line x1="12" y1="2" x2="12" y2="6"/><line x1="12" y1="18" x2="12" y2="22"/><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"/><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"/><line x1="2" y1="12" x2="6" y2="12"/><line x1="18" y1="12" x2="22" y2="12"/><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"/><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"/></svg>`,
      
      refresh: `<svg class="monoline-icon" viewBox="0 0 24 24"><polyline points="23,4 23,10 17,10"/><polyline points="1,20 1,14 7,14"/><path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/></svg>`
    };

    // Function to replace Unicode icons with SVG icons
    function replaceIconsWithSVG() {
      // Define the mapping of Unicode symbols to SVG icons
      const iconMappings = {
        'â˜°': MonolineIcons.hamburger,
        'â–·': MonolineIcons.chevronRight,
        'âš¬': MonolineIcons.route,
        '+': MonolineIcons.plus,
        'â†‘': MonolineIcons.arrowUp,
        'â†“': MonolineIcons.arrowDown,
        'â‹¯': MonolineIcons.moreHorizontal,
        'â—‹': MonolineIcons.circle,
        'â—': MonolineIcons.target,
        'â—‰': MonolineIcons.mapPin,
        'â†’': MonolineIcons.arrowRight,
        'âœ•': MonolineIcons.x,
        'â—ˆ': MonolineIcons.diamond,
        'âŠ•': MonolineIcons.crosshair,
        'â§‰': MonolineIcons.square,
        'â¬š': MonolineIcons.maximize,
        'ğŸ”„': MonolineIcons.loader,
        'â—¯': MonolineIcons.refresh
      };

      // Find all text nodes and replace Unicode symbols
      function replaceInTextNodes(element) {
        if (element.nodeType === Node.TEXT_NODE) {
          let text = element.textContent;
          let hasReplacement = false;
          
          for (const [unicode, svg] of Object.entries(iconMappings)) {
            if (text.includes(unicode)) {
              hasReplacement = true;
              text = text.replace(new RegExp(unicode.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g'), `|||${svg}|||`);
            }
          }
          
          if (hasReplacement) {
            const parts = text.split('|||');
            const fragment = document.createDocumentFragment();
            
            parts.forEach(part => {
              if (part.startsWith('<svg')) {
                const temp = document.createElement('div');
                temp.innerHTML = part;
                fragment.appendChild(temp.firstChild);
              } else if (part) {
                fragment.appendChild(document.createTextNode(part));
              }
            });
            
            element.parentNode.replaceChild(fragment, element);
          }
        } else {
          Array.from(element.childNodes).forEach(child => {
            replaceInTextNodes(child);
          });
        }
      }

      replaceInTextNodes(document.body);
    }

    // Replace icons when DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
      replaceIconsWithSVG();
    });
  </lt;/script></body>
</html>